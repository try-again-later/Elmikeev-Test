import{d as T,u as j,a as z,B as I,V as h,b as C,c as W,e as Z}from"./VTable-BF8sXkJI.js";import{u as G,s as H,a as J}from"./useNProgress-BV2_3ggy.js";import{u as K}from"./saleFilters-0QCzG7w4.js";import{a1 as O,C as g,q as w,A as D,a2 as X,a3 as y,a4 as b,h as l,c as t,a8 as ee,a9 as U,a5 as u,ab as n,a7 as B,ac as F,ad as M,ae as R,M as ae,_ as N,a6 as le,af as i}from"./index-OFEXPl3t.js";import{V as te}from"./VRangeSlider-3DDP7I3c.js";import"./startOfDay-gdqdGqv8.js";import"./format-BIKQltQg.js";function ne(V){const r=new URL("https://elmikeev.185-236-23-37.sslip.io/api/sales");return r.searchParams.append("dateFrom",T(V.dateFrom)),r.searchParams.append("dateTo",T(V.dateTo)),r.searchParams.append("page",V.page.toString()),r.searchParams.append("limit",V.limit.toString()),r.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),r}const se={class:"text-center"},ce=O({__name:"sales",setup(V){const r=K(),{dateFrom:m,dateTo:p}=G();g(m,()=>{r.dateFrom=m.value}),g(p,()=>{r.dateTo=p.value});const c=j("page","1",{transform:Number});g(m,()=>{c.value=1}),g(p,()=>{c.value=1});const A=H(new Date),E=new Date,L=w(()=>ne({dateFrom:m.value??A,dateTo:p.value??E,page:c.value,limit:100}).href),{execute:$,isFetching:q,error:P,data:_}=z(L,{refetch:!0}).get().json(),{isLoading:Q}=J();g(q,s=>{Q.value=s});const x=D(0),f=D(0),o=D([x.value,f.value]);g(_,s=>{if(s!=null){const e=o.value[1]==f.value;x.value=0,f.value=Math.max(Math.ceil(s.data.reduce((d,v)=>Math.max(d,Number.parseFloat(v.total_price)||0),0)),f.value),(o.value[1]==0||e)&&(o.value[1]=f.value)}});const k=w(()=>_.value==null?[]:_.value.data.filter(s=>o.value[0]<=Number.parseFloat(s.total_price)&&Number.parseFloat(s.total_price)<=o.value[1])),Y=w(()=>{const s=[...new Set(k.value.map(d=>d.region_name))],e=[];for(const d of s){const v=k.value.reduce((a,S)=>(S.region_name==d?Number.parseFloat(S.total_price):0)+a,0);e.push(v)}return{labels:s,datasets:[{data:e,label:"Полная сумма по региону",backgroundColor:"rgb(255, 99, 132)"}]}});return(s,e)=>{var v;const d=X("v-date-input");return b(),y(N,null,[e[10]||(e[10]=l("h1",{class:"mb-8"},"Продажи",-1)),t(B,{class:"position-relative",height:"500"},{default:u(()=>[t(n(I),{data:Y.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),t(C,null,{default:u(()=>[t(h,{cols:"12",sm:"6"},{default:u(()=>[t(d,{label:"Начиная с даты",modelValue:n(m),"onUpdate:modelValue":e[0]||(e[0]=a=>F(m)?m.value=a:null)},null,8,["modelValue"])]),_:1}),t(h,{cols:"12",sm:"6"},{default:u(()=>[t(d,{label:"Заканчивая датой",modelValue:n(p),"onUpdate:modelValue":e[1]||(e[1]=a=>F(p)?p.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),t(C,null,{default:u(()=>[t(h,{cols:"12",md:"1",class:"d-flex align-center"},{default:u(()=>e[6]||(e[6]=[M("Полная сумма:")])),_:1,__:[6]}),t(h,null,{default:u(()=>[t(te,{modelValue:n(o),"onUpdate:modelValue":e[4]||(e[4]=a=>F(o)?o.value=a:null),max:n(f),min:n(x),step:1,class:"align-center","hide-details":""},{prepend:u(()=>[t(R,{modelValue:n(o)[0],"onUpdate:modelValue":e[2]||(e[2]=a=>n(o)[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:u(()=>[t(R,{modelValue:n(o)[1],"onUpdate:modelValue":e[3]||(e[3]=a=>n(o)[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),n(P)!=null?(b(),ee(B,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:u(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),t(ae,{onClick:n($)},{default:u(()=>e[7]||(e[7]=[M("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):U("",!0),n(P)==null?(b(),y(N,{key:1},[t(W,{"fixed-header":"",striped:"even",class:"mt-8"},{default:u(()=>[e[9]||(e[9]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"ID"),l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Полная сумма"),l("th",null,"Скидка"),l("th",null,"Регион"),l("th",null,"Склад")])],-1)),l("tbody",null,[(b(!0),y(N,null,le(k.value,a=>(b(),y("tr",null,[l("td",null,i(a.nm_id),1),l("td",null,i(a.sale_id),1),l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.region_name),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),l("div",se,[t(Z,{modelValue:n(c),"onUpdate:modelValue":e[5]||(e[5]=a=>F(c)?c.value=a:null),length:(v=n(_))==null?void 0:v.meta.last_page,density:s.$vuetify.display.smAndDown?"compact":"default","total-visible":s.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):U("",!0)],64)}}});export{ce as default};
