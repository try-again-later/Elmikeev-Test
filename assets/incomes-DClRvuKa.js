import{d as S,u as j,a as z,B as I,V as b,b as U,c as W,e as Z}from"./VTable-BF8sXkJI.js";import{u as G,s as H,a as J}from"./useNProgress-BV2_3ggy.js";import{u as K}from"./incomeFilters-DXPqVgR2.js";import{a1 as O,C as c,q as k,A as q,a2 as X,a3 as x,a4 as y,h as l,c as t,a8 as ee,a9 as B,a5 as o,ab as n,a7 as M,ac as w,ad as R,ae as N,M as ae,_ as D,a6 as le,af as V}from"./index-OFEXPl3t.js";import{V as te}from"./VRangeSlider-3DDP7I3c.js";import"./startOfDay-gdqdGqv8.js";import"./format-BIKQltQg.js";function ne(g){const d=new URL("https://elmikeev.185-236-23-37.sslip.io/api/incomes");return d.searchParams.append("dateFrom",S(g.dateFrom)),d.searchParams.append("dateTo",S(g.dateTo)),d.searchParams.append("page",g.page.toString()),d.searchParams.append("limit",g.limit.toString()),d.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),d}const ue={class:"text-center"},fe=O({__name:"incomes",setup(g){const d=K(),{dateFrom:i,dateTo:m}=G();c(i,()=>{d.dateFrom=i.value}),c(m,()=>{d.dateTo=m.value});const p=j("page","1",{transform:Number});c(i,()=>{p.value=1}),c(m,()=>{p.value=1});const P=H(new Date),A=new Date,E=k(()=>ne({dateFrom:i.value??P,dateTo:m.value??A,page:p.value,limit:100}).href),{execute:L,isFetching:Q,error:T,data:h}=z(E,{refetch:!0}).get().json(),{isLoading:$}=J();c(Q,u=>{$.value=u});const _=q(0),f=q(0),s=q([_.value,f.value]);c(h,u=>{if(u!=null){const e=s.value[1]==f.value;_.value=0,f.value=Math.max(Math.ceil(u.data.reduce((r,v)=>Math.max(r,v.quantity),0)),f.value),(s.value[1]==0||e)&&(s.value[1]=f.value)}});const F=k(()=>h.value==null?[]:h.value.data.filter(u=>s.value[0]<=u.quantity&&u.quantity<=s.value[1])),Y=k(()=>{const u=[...new Set(F.value.map(r=>r.warehouse_name))],e=[];for(const r of u){const v=F.value.reduce((a,C)=>(C.warehouse_name==r?C.quantity:0)+a,0);e.push(v)}return{labels:u,datasets:[{data:e,label:"Суммарное количество в каждом складе",backgroundColor:"rgb(255, 99, 132)"}]}});return(u,e)=>{var v;const r=X("v-date-input");return y(),x(D,null,[e[10]||(e[10]=l("h1",{class:"mb-8"},"Доходы",-1)),t(M,{class:"position-relative",height:"500"},{default:o(()=>[t(n(I),{data:Y.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),t(U,null,{default:o(()=>[t(b,{cols:"12",sm:"6"},{default:o(()=>[t(r,{label:"Начиная с даты",modelValue:n(i),"onUpdate:modelValue":e[0]||(e[0]=a=>w(i)?i.value=a:null)},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:o(()=>[t(r,{label:"Заканчивая датой",modelValue:n(m),"onUpdate:modelValue":e[1]||(e[1]=a=>w(m)?m.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),t(U,null,{default:o(()=>[t(b,{cols:"12",md:"1",class:"d-flex align-center"},{default:o(()=>e[6]||(e[6]=[R("Фильтр по количеству:")])),_:1,__:[6]}),t(b,null,{default:o(()=>[t(te,{modelValue:n(s),"onUpdate:modelValue":e[4]||(e[4]=a=>w(s)?s.value=a:null),max:n(f),min:n(_),step:1,class:"align-center","hide-details":""},{prepend:o(()=>[t(N,{modelValue:n(s)[0],"onUpdate:modelValue":e[2]||(e[2]=a=>n(s)[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:o(()=>[t(N,{modelValue:n(s)[1],"onUpdate:modelValue":e[3]||(e[3]=a=>n(s)[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),n(T)!=null?(y(),ee(M,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:o(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),t(ae,{onClick:n(L)},{default:o(()=>e[7]||(e[7]=[R("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):B("",!0),n(T)==null?(y(),x(D,{key:1},[t(W,{"fixed-header":"",striped:"even",class:"mt-8"},{default:o(()=>[e[9]||(e[9]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Дата закрытия"),l("th",null,"Количество"),l("th",null,"Склад")])],-1)),l("tbody",null,[(y(!0),x(D,null,le(F.value,a=>(y(),x("tr",null,[l("td",null,V(a.nm_id),1),l("td",null,V(a.barcode),1),l("td",null,V(a.date),1),l("td",null,V(a.date_close),1),l("td",null,V(a.quantity),1),l("td",null,V(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),l("div",ue,[t(Z,{modelValue:n(p),"onUpdate:modelValue":e[5]||(e[5]=a=>w(p)?p.value=a:null),length:(v=n(h))==null?void 0:v.meta.last_page,density:u.$vuetify.display.smAndDown?"compact":"default","total-visible":u.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):B("",!0)],64)}}});export{fe as default};
