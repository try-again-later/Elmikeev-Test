import{d as B,u as U,a as I,B as O,V as _,b as W,c as P,e as Z,f as G}from"./VTable-B37YhKEG.js";import{u as H,s as J,a as K}from"./useNProgress-OwaJ0D9o.js";import{u as X}from"./orderFilters-CBEUYT5K.js";import{a1 as ee,C as c,q as y,A as C,I as le,a2 as ae,a3 as N,a4 as V,h as l,c as n,a8 as te,a9 as E,ab as s,a5 as v,ac as k,ad as R,M as $,a7 as se,_ as D,a6 as ue,af as i}from"./index-CmRbzJfx.js";import"./VList-Bc26kmH8.js";import"./format-DkDJ03km.js";function ne(h){const u=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return u.searchParams.append("dateFrom",B(h.dateFrom)),u.searchParams.append("dateTo",B(h.dateTo)),u.searchParams.append("page",h.page.toString()),u.searchParams.append("limit",h.limit.toString()),u.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),u}const oe={style:{position:"relative",height:"500px",width:"100%"}},re={class:"d-flex align-center ga-4"},de={class:"text-center"},he=ee({__name:"orders",setup(h){const u=X(),{dateFrom:f,dateTo:g}=H(),m=U("page","1",{transform:Number});c(f,()=>{m.value=1}),c(g,()=>{m.value=1});const A=J(new Date),L=new Date,Q=y(()=>ne({dateFrom:f.value??A,dateTo:g.value??L,page:m.value,limit:100}).href),{execute:q,isFetching:j,error:S,data:w}=I(Q,{refetch:!0}).get().json(),{isLoading:M}=K();c(j,t=>{M.value=t});const o=C([]),b=U("warehouses",null),r=y({get(){return b.value==null?o.value:b.value.split(",")},set(t){t.length==o.value.length?b.value=null:b.value=t.join(",")}}),T=C([]),p=C([]);le(()=>{u.dateFrom=f.value,u.dateTo=g.value,u.page=m.value,o.value.length!=r.value.length?u.warehouseNamesFilter=r.value:u.warehouseNamesFilter=null}),c(w,t=>{if(t!=null){const e=o.value.length==r.value.length;o.value=[...new Set([...t.data.map(d=>d.warehouse_name),...o.value])],(r.value.length==0||e)&&(r.value=o.value),T.value=[...new Set([...t.data.map(d=>d.nm_id)])],p.value=[]}});const x=y(()=>w.value==null?[]:w.value.data.filter(t=>r.value.includes(t.warehouse_name)&&(p.value.length==0||p.value.length>0&&p.value.includes(t.nm_id)))),Y=y(()=>{const t=[...new Set(x.value.map(d=>d.warehouse_name))],e=[];for(const d of t){const F=x.value.reduce((a,z)=>(z.warehouse_name==d?1:0)+a,0);e.push(F)}return{labels:t,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var F;const d=ae("v-date-input");return V(),N(D,null,[e[16]||(e[16]=l("h1",{class:"mb-8"},"Заказы",-1)),l("div",oe,[n(s(O),{data:Y.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),n(W,null,{default:v(()=>[n(_,{cols:"12",sm:"6"},{default:v(()=>[n(d,{label:"Начиная с даты",modelValue:s(f),"onUpdate:modelValue":e[0]||(e[0]=a=>k(f)?f.value=a:null)},null,8,["modelValue"])]),_:1}),n(_,{cols:"12",sm:"6"},{default:v(()=>[n(d,{label:"Заканчивая датой",modelValue:s(g),"onUpdate:modelValue":e[1]||(e[1]=a=>k(g)?g.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),l("div",re,[n($,{disabled:r.value.length==s(o).length,onClick:e[2]||(e[2]=a=>r.value=s(o))},{default:v(()=>e[6]||(e[6]=[R("Сбросить")])),_:1,__:[6]},8,["disabled"]),n(P,{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value=a),items:s(o),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),s(S)!=null?(V(),te(se,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:v(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),n($,{onClick:s(q)},{default:v(()=>e[7]||(e[7]=[R("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):E("",!0),s(S)==null?(V(),N(D,{key:1},[n(Z,{"fixed-header":"",striped:"even",class:"mt-8"},{default:v(()=>[l("thead",null,[l("tr",null,[l("th",null,[n(P,{modelValue:s(p),"onUpdate:modelValue":e[4]||(e[4]=a=>k(p)?p.value=a:null),items:s(T),"max-width":"250",label:"Артикул",multiple:""},null,8,["modelValue","items"])]),e[9]||(e[9]=l("th",null,"Штрих-код",-1)),e[10]||(e[10]=l("th",null,"Дата",-1)),e[11]||(e[11]=l("th",null,"Полная сумма",-1)),e[12]||(e[12]=l("th",null,"Скидка",-1)),e[13]||(e[13]=l("th",null,"Отменён",-1)),e[14]||(e[14]=l("th",null,"Регион",-1)),e[15]||(e[15]=l("th",null,"Склад",-1))])]),l("tbody",null,[(V(!0),N(D,null,ue(x.value,a=>(V(),N("tr",null,[l("td",null,i(a.nm_id),1),l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.is_cancel?"Да":"Нет"),1),l("td",null,i(a.oblast),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1}),l("div",de,[n(G,{modelValue:s(m),"onUpdate:modelValue":e[5]||(e[5]=a=>k(m)?m.value=a:null),length:(F=s(w))==null?void 0:F.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):E("",!0)],64)}}});export{he as default};
