import{d as R,u as S,a as z,B as W,V as h,b as U,c as Z,e as G}from"./VTable-ExvP3wOF.js";import{u as H,s as J,a as K}from"./useNProgress-hu3Nmi4V.js";import{u as O}from"./incomeFilters-BRjPd8Rz.js";import{a1 as X,C as b,q as x,A as B,I as ee,a2 as ae,a3 as w,a4 as y,h as t,c as n,a8 as le,a9 as M,a5 as s,ab as r,a7 as N,ac as k,ad as P,ae as E,M as te,_ as D,a6 as ne,af as c}from"./index-DVZnwRLO.js";import{V as ue}from"./VRangeSlider-CtzkaBox.js";import"./startOfDay-gdqdGqv8.js";import"./format-BIKQltQg.js";function se(g){const o=new URL("https://elmikeev.185-236-23-37.sslip.io/api/incomes");return o.searchParams.append("dateFrom",R(g.dateFrom)),o.searchParams.append("dateTo",R(g.dateTo)),o.searchParams.append("page",g.page.toString()),o.searchParams.append("limit",g.limit.toString()),o.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),o}const oe={class:"text-center"},ce=X({__name:"incomes",setup(g){const o=O(),{dateFrom:m,dateTo:p}=H(),i=S("page","1",{transform:Number});b(m,()=>{i.value=1}),b(p,()=>{i.value=1});const $=J(new Date),A=new Date,L=x(()=>se({dateFrom:m.value??$,dateTo:p.value??A,page:i.value,limit:100}).href),{execute:Q,isFetching:I,error:T,data:V}=z(L,{refetch:!0}).get().json(),{isLoading:Y}=K();b(I,l=>{Y.value=l});const _=B(0),v=B(0),q=S("quantity-range",null),u=x({get(){return q.value==null?[_.value,v.value]:q.value.split(",").map(l=>Number.parseFloat(l)||0).slice(0,2)},set(l){q.value=`${l[0]},${l[1]}`}});b(V,l=>{if(l!=null){const e=u.value[1]==v.value;_.value=0,v.value=Math.max(Math.ceil(l.data.reduce((d,f)=>Math.max(d,f.quantity),0)),v.value),(u.value[1]==0||e)&&(u.value[1]=v.value)}}),ee(()=>{o.dateFrom=m.value,o.dateTo=p.value,o.page=i.value,o.quantityRange=u.value});const F=x(()=>V.value==null?[]:V.value.data.filter(l=>u.value[0]<=l.quantity&&l.quantity<=u.value[1])),j=x(()=>{const l=[...new Set(F.value.map(d=>d.warehouse_name))],e=[];for(const d of l){const f=F.value.reduce((a,C)=>(C.warehouse_name==d?C.quantity:0)+a,0);e.push(f)}return{labels:l,datasets:[{data:e,label:"Суммарное количество в каждом складе",backgroundColor:"rgb(255, 99, 132)"}]}});return(l,e)=>{var f;const d=ae("v-date-input");return y(),w(D,null,[e[10]||(e[10]=t("h1",{class:"mb-8"},"Доходы",-1)),n(N,{class:"position-relative",height:"500"},{default:s(()=>[n(r(W),{data:j.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),n(U,null,{default:s(()=>[n(h,{cols:"12",sm:"6"},{default:s(()=>[n(d,{label:"Начиная с даты",modelValue:r(m),"onUpdate:modelValue":e[0]||(e[0]=a=>k(m)?m.value=a:null)},null,8,["modelValue"])]),_:1}),n(h,{cols:"12",sm:"6"},{default:s(()=>[n(d,{label:"Заканчивая датой",modelValue:r(p),"onUpdate:modelValue":e[1]||(e[1]=a=>k(p)?p.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),n(U,null,{default:s(()=>[n(h,{cols:"12",md:"1",class:"d-flex align-center"},{default:s(()=>e[6]||(e[6]=[P("Фильтр по количеству:")])),_:1,__:[6]}),n(h,null,{default:s(()=>[n(ue,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value=a),max:r(v),min:r(_),step:1,class:"align-center","hide-details":""},{prepend:s(()=>[n(E,{modelValue:u.value[0],"onUpdate:modelValue":e[2]||(e[2]=a=>u.value[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:s(()=>[n(E,{modelValue:u.value[1],"onUpdate:modelValue":e[3]||(e[3]=a=>u.value[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),r(T)!=null?(y(),le(N,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:s(()=>[e[8]||(e[8]=t("p",null,"Ошибка при загрузке данных",-1)),n(te,{onClick:r(Q)},{default:s(()=>e[7]||(e[7]=[P("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):M("",!0),r(T)==null?(y(),w(D,{key:1},[n(Z,{"fixed-header":"",striped:"even",class:"mt-8"},{default:s(()=>[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Артикул"),t("th",null,"Штрих-код"),t("th",null,"Дата"),t("th",null,"Дата закрытия"),t("th",null,"Количество"),t("th",null,"Склад")])],-1)),t("tbody",null,[(y(!0),w(D,null,ne(F.value,a=>(y(),w("tr",null,[t("td",null,c(a.nm_id),1),t("td",null,c(a.barcode),1),t("td",null,c(a.date),1),t("td",null,c(a.date_close),1),t("td",null,c(a.quantity),1),t("td",null,c(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),t("div",oe,[n(G,{modelValue:r(i),"onUpdate:modelValue":e[5]||(e[5]=a=>k(i)?i.value=a:null),length:(f=r(V))==null?void 0:f.meta.last_page,density:l.$vuetify.display.smAndDown?"compact":"default","total-visible":l.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):M("",!0)],64)}}});export{ce as default};
