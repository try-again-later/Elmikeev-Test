import{u as le,V as k,a as F,B as T}from"./Request-BA6AlAT3.js";import{s as se,u as oe}from"./useNProgress-B_hvUdFX.js";import{o as ie}from"./list-BDvZCJTr.js";import{g as N,p as A,ab as W,ac as ue,b as D,c as a,ad as X,ae as de,h as p,n as V,d as S,z as re,af as ce,f as j,ag as z,i as Y,a as ve,q as x,G as r,ah as pe,V as Z,e as fe,ai as G,aj as me,k as xe,l as be,m as ee,v as Pe,ak as _e,w as ge,al as Ve,am as ye,o as he,r as ke,t as Ce,an as Ee,ao as Se,a1 as Ie,A as O,C as Te,a2 as we,a3 as U,a4 as $,a8 as Be,a9 as q,a5 as i,ap as M,a7 as H,aq as J,ar as u,M as Ne,_ as K}from"./index-Biun5NIw.js";import"./toDate-CP9kJ8oq.js";const I=Symbol.for("vuetify:v-expansion-panel"),ae=A({...j(),...ce()},"VExpansionPanelText"),C=N()({name:"VExpansionPanelText",props:ae(),setup(e,v){let{slots:s}=v;const n=W(I);if(!n)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:b,onAfterLeave:g}=ue(e,n.isSelected);return D(()=>a(re,{onAfterLeave:g},{default:()=>{var f;return[X(p("div",{class:S(["v-expansion-panel-text",e.class]),style:V(e.style)},[s.default&&b.value&&p("div",{class:"v-expansion-panel-text__wrapper"},[(f=s.default)==null?void 0:f.call(s)])]),[[de,n.isSelected.value]])]}})),{}}}),te=A({color:String,expandIcon:{type:G,default:"$expand"},collapseIcon:{type:G,default:"$collapse"},hideActions:Boolean,focusable:Boolean,static:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean,...j(),...fe()},"VExpansionPanelTitle"),Q=N()({name:"VExpansionPanelTitle",directives:{vRipple:z},props:te(),setup(e,v){let{slots:s}=v;const n=W(I);if(!n)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:b,backgroundColorStyles:g}=Y(()=>e.color),{dimensionStyles:f}=ve(e),P=x(()=>({collapseIcon:e.collapseIcon,disabled:n.disabled.value,expanded:n.isSelected.value,expandIcon:e.expandIcon,readonly:e.readonly})),E=r(()=>n.isSelected.value?e.collapseIcon:e.expandIcon);return D(()=>{var m;return X(p("button",{class:S(["v-expansion-panel-title",{"v-expansion-panel-title--active":n.isSelected.value,"v-expansion-panel-title--focusable":e.focusable,"v-expansion-panel-title--static":e.static},b.value,e.class]),style:V([g.value,f.value,e.style]),type:"button",tabindex:n.disabled.value?-1:void 0,disabled:n.disabled.value,"aria-expanded":n.isSelected.value,onClick:e.readonly?void 0:n.toggle},[p("span",{class:"v-expansion-panel-title__overlay"},null),(m=s.default)==null?void 0:m.call(s,P.value),!e.hideActions&&a(Z,{defaults:{VIcon:{icon:E.value}}},{default:()=>{var d;return[p("span",{class:"v-expansion-panel-title__icon"},[((d=s.actions)==null?void 0:d.call(s,P.value))??a(pe,null,null)])]}})]),[[z,e.ripple]])}),{}}}),ne=A({title:String,text:String,bgColor:String,...ge(),..._e(),...Pe(),...ee(),...te(),...ae()},"VExpansionPanel"),w=N()({name:"VExpansionPanel",props:ne(),emits:{"group:selected":e=>!0},setup(e,v){let{slots:s}=v;const n=me(e,I),{backgroundColorClasses:b,backgroundColorStyles:g}=Y(()=>e.bgColor),{elevationClasses:f}=xe(e),{roundedClasses:P}=be(e),E=r(()=>(n==null?void 0:n.disabled.value)||e.disabled),m=x(()=>n.group.items.value.reduce((_,c,h)=>(n.group.selected.value.includes(c.id)&&_.push(h),_),[])),d=x(()=>{const _=n.group.items.value.findIndex(c=>c.id===n.id);return!n.isSelected.value&&m.value.some(c=>c-_===1)}),y=x(()=>{const _=n.group.items.value.findIndex(c=>c.id===n.id);return!n.isSelected.value&&m.value.some(c=>c-_===-1)});return Ve(I,n),D(()=>{const _=!!(s.text||e.text),c=!!(s.title||e.title),h=Q.filterProps(e),R=C.filterProps(e);return a(e.tag,{class:S(["v-expansion-panel",{"v-expansion-panel--active":n.isSelected.value,"v-expansion-panel--before-active":d.value,"v-expansion-panel--after-active":y.value,"v-expansion-panel--disabled":E.value},P.value,b.value,e.class]),style:V([g.value,e.style])},{default:()=>[p("div",{class:S(["v-expansion-panel__shadow",...f.value])},null),a(Z,{defaults:{VExpansionPanelTitle:{...h},VExpansionPanelText:{...R}}},{default:()=>{var l;return[c&&a(Q,{key:"title"},{default:()=>[s.title?s.title():e.title]}),_&&a(C,{key:"text"},{default:()=>[s.text?s.text():e.text]}),(l=s.default)==null?void 0:l.call(s)]}})]})}),{groupItem:n}}}),Ae=["default","accordion","inset","popout"],De=A({flat:Boolean,...Se(),...Ee(ne(),["bgColor","collapseIcon","color","eager","elevation","expandIcon","focusable","hideActions","readonly","ripple","rounded","tile","static"]),...Ce(),...j(),...ee(),variant:{type:String,default:"default",validator:e=>Ae.includes(e)}},"VExpansionPanels"),B=N()({name:"VExpansionPanels",props:De(),emits:{"update:modelValue":e=>!0},setup(e,v){let{slots:s}=v;const{next:n,prev:b}=ye(e,I),{themeClasses:g}=he(e),f=r(()=>e.variant&&`v-expansion-panels--variant-${e.variant}`);return ke({VExpansionPanel:{bgColor:r(()=>e.bgColor),collapseIcon:r(()=>e.collapseIcon),color:r(()=>e.color),eager:r(()=>e.eager),elevation:r(()=>e.elevation),expandIcon:r(()=>e.expandIcon),focusable:r(()=>e.focusable),hideActions:r(()=>e.hideActions),readonly:r(()=>e.readonly),ripple:r(()=>e.ripple),rounded:r(()=>e.rounded),static:r(()=>e.static)}}),D(()=>a(e.tag,{class:S(["v-expansion-panels",{"v-expansion-panels--flat":e.flat,"v-expansion-panels--tile":e.tile},g.value,f.value,e.class]),style:V(e.style)},{default:()=>{var P;return[(P=s.default)==null?void 0:P.call(s,{prev:b,next:n})]}})),{next:n,prev:b}}}),ze=Ie({__name:"index",setup(e){const v=O(se(new Date)),s=O(new Date),n=x(()=>ie({dateFrom:v.value,dateTo:s.value,page:1,limit:500}).href),{execute:b,isFetching:g,error:f,data:P}=le(n,{refetch:!0}).get().json(),{isLoading:E}=oe();Te(g,l=>{E.value=l});const m=x(()=>P.value==null?[]:P.value.data),d=x(()=>[...new Set(m.value.map(l=>l.nm_id))]),y={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{ticks:{display:!0,autoSkip:!1},position:"top"}}},_=x(()=>{const l={};for(const t of m.value)t.nm_id in l?l[t.nm_id]+=1:l[t.nm_id]=1;const o=[];for(const t of d.value)o.push(l[t]);return{labels:d.value,datasets:[{data:o,label:"Количество продаж по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}}),c=x(()=>{const l={};for(const t of m.value)t.nm_id in l?l[t.nm_id]+=Number.parseFloat(t.total_price)||0:l[t.nm_id]=Number.parseFloat(t.total_price)||0;const o=[];for(const t of d.value)o.push(l[t]);return{labels:d.value,datasets:[{data:o,label:"Суммарная стоимость продаж по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}}),h=x(()=>{const l={};for(const t of m.value)t.is_cancel&&(t.nm_id in l?l[t.nm_id]+=1:l[t.nm_id]=1);const o=[];for(const t of d.value)t in l&&o.push(l[t]);return{labels:Object.keys(l),datasets:[{data:o,label:"Количество отмен по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}}),R=x(()=>{const l={};for(const t of m.value)t.nm_id in l?(l[t.nm_id].count+=1,l[t.nm_id].sum+=t.discount_percent):l[t.nm_id]={count:1,sum:t.discount_percent};const o=[];for(const t of d.value)o.push(l[t].sum/l[t].count);return{labels:d.value,datasets:[{data:o,label:"Средняя скидка по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}});return(l,o)=>{const t=we("v-date-input");return $(),U(K,null,[o[5]||(o[5]=p("h1",{class:"mb-8"},"Главная",-1)),a(H,null,{default:i(()=>o[2]||(o[2]=[M("Текущий период")])),_:1,__:[2]}),a(F,null,{default:i(()=>[a(k,{cols:"12",sm:"6"},{default:i(()=>[a(t,{label:"Начиная с даты",modelValue:u(v),"onUpdate:modelValue":o[0]||(o[0]=L=>J(v)?v.value=L:null)},null,8,["modelValue"])]),_:1}),a(k,{cols:"12",sm:"6"},{default:i(()=>[a(t,{label:"Заканчивая датой",modelValue:u(s),"onUpdate:modelValue":o[1]||(o[1]=L=>J(s)?s.value=L:null)},null,8,["modelValue"])]),_:1})]),_:1}),u(f)!=null?($(),Be(H,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:i(()=>[o[4]||(o[4]=p("p",null,"Ошибка при загрузке данных",-1)),a(Ne,{onClick:u(b)},{default:i(()=>o[3]||(o[3]=[M("Попробовать ещё раз")])),_:1,__:[3]},8,["onClick"])]),_:1,__:[4]})):q("",!0),u(f)==null?($(),U(K,{key:1},[a(F,null,{default:i(()=>[a(k,{cols:"12",sm:"6",class:"position-relative"},{default:i(()=>[a(B,null,{default:i(()=>[a(w,{title:"Количество продаж по каждому артикулу"},{default:i(()=>[a(C,null,{default:i(()=>[p("div",{style:V(`position: relative; height: ${u(d).length*20}px; width: 100%`)},[a(u(T),{data:u(_),options:y},null,8,["data"])],4)]),_:1})]),_:1})]),_:1})]),_:1}),a(k,{cols:"12",sm:"6",class:"position-relative"},{default:i(()=>[a(B,null,{default:i(()=>[a(w,{title:"Суммарная стоимость продаж по каждому артикулу"},{default:i(()=>[a(C,null,{default:i(()=>[p("div",{style:V(`position: relative; height: ${u(d).length*20}px; width: 100%`)},[a(u(T),{data:u(c),options:y},null,8,["data"])],4)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(F,null,{default:i(()=>[a(k,{cols:"12",sm:"6",class:"position-relative"},{default:i(()=>[a(B,null,{default:i(()=>[a(w,{title:"Количество отмен по каждому артикулу"},{default:i(()=>[a(C,null,{default:i(()=>[p("div",{style:V(`position: relative; height: ${u(h).datasets[0].data.length*20}px; width: 100%`)},[a(u(T),{data:u(h),options:y},null,8,["data"])],4)]),_:1})]),_:1})]),_:1})]),_:1}),a(k,{cols:"12",sm:"6",class:"position-relative"},{default:i(()=>[a(B,null,{default:i(()=>[a(w,{title:"Средняя скидка по каждому артикулу"},{default:i(()=>[a(C,null,{default:i(()=>[p("div",{style:V(`position: relative; height: ${u(d).length*20}px; width: 100%`)},[a(u(T),{data:u(R),options:y},null,8,["data"])],4)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)):q("",!0)],64)}}});export{ze as default};
