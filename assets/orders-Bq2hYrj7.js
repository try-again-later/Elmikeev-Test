import{d as x,u as E,a as L,B as q,V as C,b as Q,c as Y,e as j}from"./VTable-D_1NACGu.js";import{u as z,a as M}from"./useNProgress-DAHxmbt2.js";import{a1 as W,C as V,q as y,A as N,a2 as Z,a3 as _,a4 as c,h as a,c as u,a8 as G,a9 as B,aa as t,a5 as i,ab as w,ac as D,M as P,a7 as H,_ as F,a6 as I,ae as m}from"./index-Egqax8-Z.js";import{V as J}from"./VSelect-BkdXE0RB.js";import"./VList-fnc3sjQx.js";function K(v){const s=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return s.searchParams.append("dateFrom",x(v.dateFrom)),s.searchParams.append("dateTo",x(v.dateTo)),s.searchParams.append("page",v.page.toString()),s.searchParams.append("limit",v.limit.toString()),s.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),s}const O={style:{position:"relative",height:"500px",width:"100%"}},X={class:"d-flex align-center ga-4"},ee={class:"text-center"},ue=W({__name:"orders",setup(v){const{dateFrom:s,dateTo:f}=z(),p=E("page","1",{transform:Number});V(s,()=>{p.value=1}),V(f,()=>{p.value=1});const S=y(()=>K({dateFrom:s.value??new Date,dateTo:f.value??new Date,page:p.value,limit:100}).href),{execute:T,isFetching:U,error:k,data:h}=L(S,{refetch:!0}).get().json(),{isLoading:R}=M();V(U,n=>{R.value=n});const d=N([]),o=N([]);V(h,n=>{if(n!=null){const e=d.value.length==o.value.length;d.value=[...new Set([...n.data.map(r=>r.warehouse_name),...d.value])],(o.value.length==0||e)&&(o.value=d.value)}});const b=y(()=>h.value==null?[]:h.value.data.filter(n=>o.value.includes(n.warehouse_name))),$=y(()=>{const n=[...new Set(b.value.map(r=>r.warehouse_name))],e=[];for(const r of n){const g=b.value.reduce((l,A)=>(A.warehouse_name==r?1:0)+l,0);e.push(g)}return{labels:n,datasets:[{data:e,label:"Количество заказов по каждому складу"}]}});return(n,e)=>{var g;const r=Z("v-date-input");return c(),_(F,null,[e[9]||(e[9]=a("h1",{class:"mb-8"},"Заказы",-1)),a("div",O,[u(t(q),{data:$.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),u(Q,null,{default:i(()=>[u(C,{cols:"12",sm:"6"},{default:i(()=>[u(r,{label:"Начиная с даты",modelValue:t(s),"onUpdate:modelValue":e[0]||(e[0]=l=>w(s)?s.value=l:null)},null,8,["modelValue"])]),_:1}),u(C,{cols:"12",sm:"6"},{default:i(()=>[u(r,{label:"Заканчивая датой",modelValue:t(f),"onUpdate:modelValue":e[1]||(e[1]=l=>w(f)?f.value=l:null)},null,8,["modelValue"])]),_:1})]),_:1}),a("div",X,[u(P,{disabled:t(o).length==t(d).length,onClick:e[2]||(e[2]=l=>o.value=t(d))},{default:i(()=>e[5]||(e[5]=[D("Сбросить")])),_:1,__:[5]},8,["disabled"]),u(J,{modelValue:t(o),"onUpdate:modelValue":e[3]||(e[3]=l=>w(o)?o.value=l:null),items:t(d),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),t(k)!=null?(c(),G(H,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:i(()=>[e[7]||(e[7]=a("p",null,"Ошибка при загрузке данных",-1)),u(P,{onClick:t(T)},{default:i(()=>e[6]||(e[6]=[D("Попробовать ещё раз")])),_:1,__:[6]},8,["onClick"])]),_:1,__:[7]})):B("",!0),t(k)==null?(c(),_(F,{key:1},[u(Y,{"fixed-header":"",striped:"even",class:"mt-8"},{default:i(()=>[e[8]||(e[8]=a("thead",null,[a("tr",null,[a("th",null,"Штрих-код"),a("th",null,"Дата"),a("th",null,"Полная сумма"),a("th",null,"Скидка"),a("th",null,"Отменён"),a("th",null,"Регион"),a("th",null,"Склад")])],-1)),a("tbody",null,[(c(!0),_(F,null,I(b.value,l=>(c(),_("tr",null,[a("td",null,m(l.barcode),1),a("td",null,m(l.date),1),a("td",null,m(parseFloat(l.total_price).toFixed(2)),1),a("td",null,m(`${l.discount_percent}%`),1),a("td",null,m(l.is_cancel?"Да":"Нет"),1),a("td",null,m(l.oblast),1),a("td",null,m(l.warehouse_name),1)]))),256))])]),_:1,__:[8]}),a("div",ee,[u(j,{modelValue:t(p),"onUpdate:modelValue":e[4]||(e[4]=l=>w(p)?p.value=l:null),length:(g=t(h))==null?void 0:g.meta.last_page,density:n.$vuetify.display.smAndDown?"compact":"default","total-visible":n.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):B("",!0)],64)}}});export{ue as default};
