import{d as T,u as j,a as z,B as I,V as h,b as R,c as W,e as Z}from"./VTable-BaN9w69I.js";import{u as G,s as H,a as J}from"./useNProgress-D76amKe5.js";import{aa as K,A as f,a1 as O,ab as X,C as y,q as P,a2 as ee,a3 as F,a4 as b,h as l,c as t,a8 as ae,a9 as C,a5 as u,ac as n,a7 as U,ad as x,ae as B,af as M,M as le,_ as D,a6 as te,ag as p}from"./index-TBuvqor5.js";import{V as ne}from"./VRangeSlider-CVPHYtP_.js";function se(c){const r=new URL("https://elmikeev.185-236-23-37.sslip.io/api/sales");return r.searchParams.append("dateFrom",T(c.dateFrom)),r.searchParams.append("dateTo",T(c.dateTo)),r.searchParams.append("page",c.page.toString()),r.searchParams.append("limit",c.limit.toString()),r.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),r}const oe=K("filters",()=>{const c=f(null),r=f(null),d=f(null),i=f(null);return{dateFrom:c,dateTo:r,page:d,totalPriceRange:i}}),ue={class:"text-center"},pe=O({__name:"sales",setup(c){const r=oe(),{dateFrom:d,dateTo:i}=X(r);G(d,i);const v=j("page","1",{transform:Number});y(d,()=>{v.value=1}),y(i,()=>{v.value=1});const A=H(new Date),E=new Date,L=P(()=>se({dateFrom:d.value??A,dateTo:i.value??E,page:v.value,limit:100}).href),{execute:$,isFetching:q,error:N,data:_}=z(L,{refetch:!0}).get().json(),{isLoading:Q}=J();y(q,s=>{Q.value=s});const k=f(0),g=f(0),o=f([k.value,g.value]);y(_,s=>{if(s!=null){const e=o.value[1]==g.value;k.value=0,g.value=Math.max(Math.ceil(s.data.reduce((m,V)=>Math.max(m,Number.parseFloat(V.total_price)||0),0)),g.value),(o.value[1]==0||e)&&(o.value[1]=g.value)}});const w=P(()=>_.value==null?[]:_.value.data.filter(s=>o.value[0]<=Number.parseFloat(s.total_price)&&Number.parseFloat(s.total_price)<=o.value[1])),Y=P(()=>{const s=[...new Set(w.value.map(m=>m.region_name))],e=[];for(const m of s){const V=w.value.reduce((a,S)=>(S.region_name==m?Number.parseFloat(S.total_price):0)+a,0);e.push(V)}return{labels:s,datasets:[{data:e,label:"Полная сумма по региону",backgroundColor:"rgb(255, 99, 132)"}]}});return(s,e)=>{var V;const m=ee("v-date-input");return b(),F(D,null,[e[10]||(e[10]=l("h1",{class:"mb-8"},"Продажи",-1)),t(U,{class:"position-relative",height:"500"},{default:u(()=>[t(n(I),{data:Y.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),t(R,null,{default:u(()=>[t(h,{cols:"12",sm:"6"},{default:u(()=>[t(m,{label:"Начиная с даты",modelValue:n(d),"onUpdate:modelValue":e[0]||(e[0]=a=>x(d)?d.value=a:null)},null,8,["modelValue"])]),_:1}),t(h,{cols:"12",sm:"6"},{default:u(()=>[t(m,{label:"Заканчивая датой",modelValue:n(i),"onUpdate:modelValue":e[1]||(e[1]=a=>x(i)?i.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),t(R,null,{default:u(()=>[t(h,{cols:"12",md:"1",class:"d-flex align-center"},{default:u(()=>e[6]||(e[6]=[B("Полная сумма:")])),_:1,__:[6]}),t(h,null,{default:u(()=>[t(ne,{modelValue:n(o),"onUpdate:modelValue":e[4]||(e[4]=a=>x(o)?o.value=a:null),max:n(g),min:n(k),step:1,class:"align-center","hide-details":""},{prepend:u(()=>[t(M,{modelValue:n(o)[0],"onUpdate:modelValue":e[2]||(e[2]=a=>n(o)[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:u(()=>[t(M,{modelValue:n(o)[1],"onUpdate:modelValue":e[3]||(e[3]=a=>n(o)[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),n(N)!=null?(b(),ae(U,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:u(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),t(le,{onClick:n($)},{default:u(()=>e[7]||(e[7]=[B("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):C("",!0),n(N)==null?(b(),F(D,{key:1},[t(W,{"fixed-header":"",striped:"even",class:"mt-8"},{default:u(()=>[e[9]||(e[9]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"ID"),l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Полная сумма"),l("th",null,"Скидка"),l("th",null,"Регион"),l("th",null,"Склад")])],-1)),l("tbody",null,[(b(!0),F(D,null,te(w.value,a=>(b(),F("tr",null,[l("td",null,p(a.nm_id),1),l("td",null,p(a.sale_id),1),l("td",null,p(a.barcode),1),l("td",null,p(a.date),1),l("td",null,p(parseFloat(a.total_price).toFixed(2)),1),l("td",null,p(`${a.discount_percent}%`),1),l("td",null,p(a.region_name),1),l("td",null,p(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),l("div",ue,[t(Z,{modelValue:n(v),"onUpdate:modelValue":e[5]||(e[5]=a=>x(v)?v.value=a:null),length:(V=n(_))==null?void 0:V.meta.last_page,density:s.$vuetify.display.smAndDown?"compact":"default","total-visible":s.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):C("",!0)],64)}}});export{pe as default};
