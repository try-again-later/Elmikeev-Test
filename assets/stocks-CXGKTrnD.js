import{d as T,u as V,a as E,V as b,P,b as S,c as h,e as B,f as Q}from"./VTable-B37YhKEG.js";import{u as q}from"./stockFilters-Cv8TvMhj.js";import{s as L}from"./VList-Bc26kmH8.js";import{a1 as $,q as v,A as W,I,C as O,a3 as _,a4 as w,h as a,c as n,a9 as Y,a5 as r,ab as i,_ as C,ac as N,a6 as j,af as d}from"./index-CmRbzJfx.js";function z(u){return L(Date.now(),u)}function Z(u){const s=new URL("https://elmikeev.185-236-23-37.sslip.io/api/stocks");return s.searchParams.append("dateFrom",T(u.dateFrom)),s.searchParams.append("dateTo",T(u.dateTo)),s.searchParams.append("page",u.page.toString()),s.searchParams.append("limit",u.limit.toString()),s.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),s}const G={class:"text-center"},X=$({__name:"stocks",setup(u){const s=q(),c=V("page","1",{transform:Number}),U=v(()=>Z({dateFrom:z(),dateTo:new Date,page:c.value,limit:100}).href),{error:x,data:g}=E(U,{refetch:!0}).get().json(),k=V("in-way-to-client","Не важно"),m=v({get(){return k.value},set(t){k.value=t}}),F=V("in-way-from-client","Не важно"),p=v({get(){return F.value},set(t){F.value=t}}),D=W([]),o=W([]);I(()=>{s.page=c.value,s.inWayFromClient=p.value,s.inWayToClient=m.value}),O(g,t=>{t!=null&&(D.value=[...new Set([...t.data.map(e=>e.nm_id)])],o.value=[])});const y=v(()=>g.value==null?[]:g.value.data.filter(t=>{let e=!0;return m.value!="Не важно"&&e&&(e=m.value=="Да"&&t.in_way_to_client||m.value=="Нет"&&!t.in_way_to_client),p.value!="Не важно"&&e&&(e=p.value=="Да"&&t.in_way_from_client||p.value=="Нет"&&!t.in_way_from_client),e&&(e=o.value.length==0||o.value.length>0&&o.value.includes(t.nm_id)),e})),R=v(()=>{const t=[0,0];return t[0]=y.value.reduce((e,f)=>e+(f.in_way_to_client?1:0),0),t[1]=y.value.length-t[0],t}),A=v(()=>{const t=[0,0];return t[0]=y.value.reduce((e,f)=>e+(f.in_way_from_client?1:0),0),t[1]=y.value.length-t[0],t});return(t,e)=>{var f;return w(),_(C,null,[e[10]||(e[10]=a("h1",{class:"mb-8"},"Склады",-1)),n(S,null,{default:r(()=>[n(b,{cols:"12",sm:"6",class:"position-relative",height:"500"},{default:r(()=>[n(i(P),{data:{labels:["Да","Нет"],datasets:[{label:"В пути к клиенту",data:R.value,backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"В пути к клиенту"}}}},null,8,["data"])]),_:1}),n(b,{cols:"12",sm:"6",class:"position-relative",height:"500"},{default:r(()=>[n(i(P),{data:{labels:["Да","Нет"],datasets:[{label:"В пути от клиента",data:A.value,backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"В пути от клиента"}}}},null,8,["data"])]),_:1})]),_:1}),n(S,null,{default:r(()=>[n(b,{cols:"12",sm:"6"},{default:r(()=>[n(h,{label:"В пути к клиенту",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),items:["Да","Нет","Не важно"]},null,8,["modelValue"])]),_:1}),n(b,{cols:"12",sm:"6"},{default:r(()=>[n(h,{label:"В пути от клиента",modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=l=>p.value=l),items:["Да","Нет","Не важно"]},null,8,["modelValue"])]),_:1})]),_:1}),i(x)==null?(w(),_(C,{key:0},[n(B,{"fixed-header":"",striped:"even",class:"mt-8"},{default:r(()=>[a("thead",null,[a("tr",null,[a("th",null,[n(h,{modelValue:i(o),"onUpdate:modelValue":e[2]||(e[2]=l=>N(o)?o.value=l:null),items:i(D),"max-width":"250",label:"Артикул",multiple:""},null,8,["modelValue","items"])]),e[4]||(e[4]=a("th",null,"Штрих-код",-1)),e[5]||(e[5]=a("th",null,"Дата",-1)),e[6]||(e[6]=a("th",null,"Склад",-1)),e[7]||(e[7]=a("th",null,"Стоимость",-1)),e[8]||(e[8]=a("th",null,"В пути к клиенту",-1)),e[9]||(e[9]=a("th",null,"В пути от клиента",-1))])]),a("tbody",null,[(w(!0),_(C,null,j(y.value,l=>(w(),_("tr",null,[a("td",null,d(l.nm_id),1),a("td",null,d(l.barcode),1),a("td",null,d(l.date),1),a("td",null,d(l.warehouse_name),1),a("td",null,d(l.price??0),1),a("td",null,d(l.in_way_to_client?"Да":"Нет"),1),a("td",null,d(l.in_way_from_client?"Да":"Нет"),1)]))),256))])]),_:1}),a("div",G,[n(Q,{modelValue:i(c),"onUpdate:modelValue":e[3]||(e[3]=l=>N(c)?c.value=l:null),length:(f=i(g))==null?void 0:f.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):Y("",!0)],64)}}});export{X as default};
