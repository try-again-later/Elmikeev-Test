import{d as x,u as D,a as j,B as M,V as S,b as Y,c as z,e as I}from"./VTable-B_20iPVk.js";import{u as O,s as W,a as Z}from"./useNProgress-Cx3CZ0Yg.js";import{u as G}from"./orderFilters-xwgXlMhw.js";import{a1 as H,C as w,q as _,A as J,I as K,a2 as X,a3 as b,a4 as h,h as a,c as n,a8 as ee,a9 as T,ab as u,a5 as p,ac as k,ad as B,M as P,a7 as ae,_ as C,a6 as le,af as d}from"./index-CuxgLMCI.js";import{V as te}from"./VSelect-Dv-_GBPS.js";import"./startOfDay-gdqdGqv8.js";import"./format-BIKQltQg.js";import"./VList-CgXDfau6.js";function se(c){const s=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return s.searchParams.append("dateFrom",x(c.dateFrom)),s.searchParams.append("dateTo",x(c.dateTo)),s.searchParams.append("page",c.page.toString()),s.searchParams.append("limit",c.limit.toString()),s.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),s}const ne={style:{position:"relative",height:"500px",width:"100%"}},ue={class:"d-flex align-center ga-4"},oe={class:"text-center"},he=H({__name:"orders",setup(c){const s=G(),{dateFrom:v,dateTo:f}=O(),i=D("page","1",{transform:Number});w(v,()=>{i.value=1}),w(f,()=>{i.value=1});const U=W(new Date),R=new Date,E=_(()=>se({dateFrom:v.value??U,dateTo:f.value??R,page:i.value,limit:100}).href),{execute:$,isFetching:A,error:N,data:g}=j(E,{refetch:!0}).get().json(),{isLoading:L}=Z();w(A,t=>{L.value=t});const m=J([]),F=D("warehouses"),o=_({get(){return F.value==null?[]:F.value.split(",")},set(t){F.value=t.join(",")}});w(g,t=>{if(t!=null){const e=m.value.length==o.value.length;m.value=[...new Set([...t.data.map(r=>r.warehouse_name),...m.value])],(o.value.length==0||e)&&(o.value=m.value)}}),K(()=>{s.dateFrom=v.value,s.dateTo=f.value,s.page=i.value,s.warehouseNamesFilter=o.value});const y=_(()=>g.value==null?[]:g.value.data.filter(t=>o.value.includes(t.warehouse_name))),Q=_(()=>{const t=[...new Set(y.value.map(r=>r.warehouse_name))],e=[];for(const r of t){const V=y.value.reduce((l,q)=>(q.warehouse_name==r?1:0)+l,0);e.push(V)}return{labels:t,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var V;const r=X("v-date-input");return h(),b(C,null,[e[9]||(e[9]=a("h1",{class:"mb-8"},"Заказы",-1)),a("div",ne,[n(u(M),{data:Q.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),n(Y,null,{default:p(()=>[n(S,{cols:"12",sm:"6"},{default:p(()=>[n(r,{label:"Начиная с даты",modelValue:u(v),"onUpdate:modelValue":e[0]||(e[0]=l=>k(v)?v.value=l:null)},null,8,["modelValue"])]),_:1}),n(S,{cols:"12",sm:"6"},{default:p(()=>[n(r,{label:"Заканчивая датой",modelValue:u(f),"onUpdate:modelValue":e[1]||(e[1]=l=>k(f)?f.value=l:null)},null,8,["modelValue"])]),_:1})]),_:1}),a("div",ue,[n(P,{disabled:o.value.length==u(m).length,onClick:e[2]||(e[2]=l=>o.value=u(m))},{default:p(()=>e[5]||(e[5]=[B("Сбросить")])),_:1,__:[5]},8,["disabled"]),n(te,{modelValue:o.value,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value=l),items:u(m),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),u(N)!=null?(h(),ee(ae,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:p(()=>[e[7]||(e[7]=a("p",null,"Ошибка при загрузке данных",-1)),n(P,{onClick:u($)},{default:p(()=>e[6]||(e[6]=[B("Попробовать ещё раз")])),_:1,__:[6]},8,["onClick"])]),_:1,__:[7]})):T("",!0),u(N)==null?(h(),b(C,{key:1},[n(z,{"fixed-header":"",striped:"even",class:"mt-8"},{default:p(()=>[e[8]||(e[8]=a("thead",null,[a("tr",null,[a("th",null,"Артикул"),a("th",null,"Штрих-код"),a("th",null,"Дата"),a("th",null,"Полная сумма"),a("th",null,"Скидка"),a("th",null,"Отменён"),a("th",null,"Регион"),a("th",null,"Склад")])],-1)),a("tbody",null,[(h(!0),b(C,null,le(y.value,l=>(h(),b("tr",null,[a("td",null,d(l.nm_id),1),a("td",null,d(l.barcode),1),a("td",null,d(l.date),1),a("td",null,d(parseFloat(l.total_price).toFixed(2)),1),a("td",null,d(`${l.discount_percent}%`),1),a("td",null,d(l.is_cancel?"Да":"Нет"),1),a("td",null,d(l.oblast),1),a("td",null,d(l.warehouse_name),1)]))),256))])]),_:1,__:[8]}),a("div",oe,[n(I,{modelValue:u(i),"onUpdate:modelValue":e[4]||(e[4]=l=>k(i)?i.value=l:null),length:(V=u(g))==null?void 0:V.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):T("",!0)],64)}}});export{he as default};
