import{d as B,u as M,a as Z,B as G,V as y,b as R,c as H,e as J,f as K}from"./VTable-B37YhKEG.js";import{u as O,s as X,a as ee}from"./useNProgress-OwaJ0D9o.js";import{u as le}from"./saleFilters-2krXA8yG.js";import{a1 as ae,C as x,q as N,A as w,I as te,a2 as ne,a3 as P,a4 as b,h as a,c as n,a8 as ue,a9 as $,a5 as s,ab as o,a7 as E,ac as k,ad as A,ae as L,M as se,_ as T,a6 as oe,af as i}from"./index-CmRbzJfx.js";import{V as re}from"./VRangeSlider-DUSKCKAU.js";import"./VList-Bc26kmH8.js";import"./format-DkDJ03km.js";function de(c){const r=new URL("https://elmikeev.185-236-23-37.sslip.io/api/sales");return r.searchParams.append("dateFrom",B(c.dateFrom)),r.searchParams.append("dateTo",B(c.dateTo)),r.searchParams.append("page",c.page.toString()),r.searchParams.append("limit",c.limit.toString()),r.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),r}const ie={class:"text-center"},be=ae({__name:"sales",setup(c){const r=le(),{dateFrom:v,dateTo:f}=O(),m=M("page","1",{transform:Number});x(v,()=>{m.value=1}),x(f,()=>{m.value=1});const Q=X(new Date),q=new Date,I=N(()=>de({dateFrom:v.value??Q,dateTo:f.value??q,page:m.value,limit:100}).href),{execute:Y,isFetching:j,error:U,data:F}=Z(I,{refetch:!0}).get().json(),{isLoading:z}=ee();x(j,t=>{z.value=t});const S=w(0),g=w(0),h=M("price-range",null),u=N({get(){return h.value==null?[S.value,g.value]:h.value.split(",").map(t=>Number.parseFloat(t)||0).slice(0,2)},set(t){h.value=`${t[0]},${t[1]}`}}),C=w([]),p=w([]);te(()=>{r.dateFrom=v.value,r.dateTo=f.value,r.page=m.value,r.totalPriceRange=u.value}),x(F,t=>{if(t!=null){const e=u.value[1]==g.value;S.value=0,g.value=Math.max(Math.ceil(t.data.reduce((d,V)=>Math.max(d,Number.parseFloat(V.total_price)||0),0)),g.value),(u.value[1]==0||e)&&(u.value[1]=g.value),C.value=[...new Set([...t.data.map(d=>d.nm_id)])],p.value=[]}});const D=N(()=>F.value==null?[]:F.value.data.filter(t=>u.value[0]<=Number.parseFloat(t.total_price)&&Number.parseFloat(t.total_price)<=u.value[1]&&(p.value.length==0||p.value.length>0&&p.value.includes(t.nm_id)))),W=N(()=>{const t=[...new Set(D.value.map(d=>d.region_name))],e=[];for(const d of t){const V=D.value.reduce((l,_)=>(_.region_name==d?Number.parseFloat(_.total_price):0)+l,0);e.push(V)}return{labels:t,datasets:[{data:e,label:"Полная сумма по региону",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var V;const d=ne("v-date-input");return b(),P(T,null,[e[17]||(e[17]=a("h1",{class:"mb-8"},"Продажи",-1)),n(E,{class:"position-relative",height:"500"},{default:s(()=>[n(o(G),{data:W.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),n(R,null,{default:s(()=>[n(y,{cols:"12",sm:"6"},{default:s(()=>[n(d,{label:"Начиная с даты",modelValue:o(v),"onUpdate:modelValue":e[0]||(e[0]=l=>k(v)?v.value=l:null)},null,8,["modelValue"])]),_:1}),n(y,{cols:"12",sm:"6"},{default:s(()=>[n(d,{label:"Заканчивая датой",modelValue:o(f),"onUpdate:modelValue":e[1]||(e[1]=l=>k(f)?f.value=l:null)},null,8,["modelValue"])]),_:1})]),_:1}),n(R,null,{default:s(()=>[n(y,{cols:"12",md:"1",class:"d-flex align-center"},{default:s(()=>e[7]||(e[7]=[A("Полная сумма:")])),_:1,__:[7]}),n(y,null,{default:s(()=>[n(re,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value=l),max:o(g),min:o(S),step:1,class:"align-center","hide-details":""},{prepend:s(()=>[n(L,{modelValue:u.value[0],"onUpdate:modelValue":e[2]||(e[2]=l=>u.value[0]=l),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:s(()=>[n(L,{modelValue:u.value[1],"onUpdate:modelValue":e[3]||(e[3]=l=>u.value[1]=l),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),o(U)!=null?(b(),ue(E,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:s(()=>[e[9]||(e[9]=a("p",null,"Ошибка при загрузке данных",-1)),n(se,{onClick:o(Y)},{default:s(()=>e[8]||(e[8]=[A("Попробовать ещё раз")])),_:1,__:[8]},8,["onClick"])]),_:1,__:[9]})):$("",!0),o(U)==null?(b(),P(T,{key:1},[n(J,{"fixed-header":"",striped:"even",class:"mt-8"},{default:s(()=>[a("thead",null,[a("tr",null,[a("th",null,[n(H,{modelValue:o(p),"onUpdate:modelValue":e[5]||(e[5]=l=>k(p)?p.value=l:null),items:o(C),"max-width":"250",label:"Артикул",multiple:""},null,8,["modelValue","items"])]),e[10]||(e[10]=a("th",null,"ID",-1)),e[11]||(e[11]=a("th",null,"Штрих-код",-1)),e[12]||(e[12]=a("th",null,"Дата",-1)),e[13]||(e[13]=a("th",null,"Полная сумма",-1)),e[14]||(e[14]=a("th",null,"Скидка",-1)),e[15]||(e[15]=a("th",null,"Регион",-1)),e[16]||(e[16]=a("th",null,"Склад",-1))])]),a("tbody",null,[(b(!0),P(T,null,oe(D.value,l=>(b(),P("tr",null,[a("td",null,i(l.nm_id),1),a("td",null,i(l.sale_id),1),a("td",null,i(l.barcode),1),a("td",null,i(l.date),1),a("td",null,i(parseFloat(l.total_price).toFixed(2)),1),a("td",null,i(`${l.discount_percent}%`),1),a("td",null,i(l.region_name),1),a("td",null,i(l.warehouse_name),1)]))),256))])]),_:1}),a("div",ie,[n(K,{modelValue:o(m),"onUpdate:modelValue":e[6]||(e[6]=l=>k(m)?m.value=l:null),length:(V=o(F))==null?void 0:V.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):$("",!0)],64)}}});export{be as default};
