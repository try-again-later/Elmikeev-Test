import{d as T,u as C,a as z,B as W,V as _,b as R,c as Z,e as G}from"./VTable-B_20iPVk.js";import{u as H,s as J,a as K}from"./useNProgress-Cx3CZ0Yg.js";import{u as O}from"./saleFilters-CNmSgV0D.js";import{a1 as X,C as h,q as y,A as U,I as ee,a2 as ae,a3 as F,a4 as V,h as l,c as n,a8 as le,a9 as B,a5 as s,ab as r,a7 as M,ac as k,ad as $,ae as E,M as te,_ as w,a6 as ne,af as i}from"./index-CuxgLMCI.js";import{V as ue}from"./VRangeSlider-CulDJyPn.js";import"./startOfDay-gdqdGqv8.js";import"./format-BIKQltQg.js";function se(g){const o=new URL("https://elmikeev.185-236-23-37.sslip.io/api/sales");return o.searchParams.append("dateFrom",T(g.dateFrom)),o.searchParams.append("dateTo",T(g.dateTo)),o.searchParams.append("page",g.page.toString()),o.searchParams.append("limit",g.limit.toString()),o.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),o}const oe={class:"text-center"},fe=X({__name:"sales",setup(g){const o=O(),{dateFrom:p,dateTo:c}=H(),m=C("page","1",{transform:Number});h(p,()=>{m.value=1}),h(c,()=>{m.value=1});const A=J(new Date),L=new Date,Q=y(()=>se({dateFrom:p.value??A,dateTo:c.value??L,page:m.value,limit:100}).href),{execute:q,isFetching:I,error:N,data:b}=z(Q,{refetch:!0}).get().json(),{isLoading:Y}=K();h(I,t=>{Y.value=t});const x=U(0),v=U(0),D=C("price-range",`${x.value},${v.value}`),u=y({get(){return D.value.split(",").map(t=>Number.parseFloat(t)||0).slice(0,2)},set(t){D.value=`${t[0]},${t[1]}`}});ee(()=>{o.dateFrom=p.value,o.dateTo=c.value,o.page=m.value,o.totalPriceRange=u.value}),h(b,t=>{if(t!=null){const e=u.value[1]==v.value;x.value=0,v.value=Math.max(Math.ceil(t.data.reduce((d,f)=>Math.max(d,Number.parseFloat(f.total_price)||0),0)),v.value),(u.value[1]==0||e)&&(u.value[1]=v.value)}});const P=y(()=>b.value==null?[]:b.value.data.filter(t=>u.value[0]<=Number.parseFloat(t.total_price)&&Number.parseFloat(t.total_price)<=u.value[1])),j=y(()=>{const t=[...new Set(P.value.map(d=>d.region_name))],e=[];for(const d of t){const f=P.value.reduce((a,S)=>(S.region_name==d?Number.parseFloat(S.total_price):0)+a,0);e.push(f)}return{labels:t,datasets:[{data:e,label:"Полная сумма по региону",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var f;const d=ae("v-date-input");return V(),F(w,null,[e[10]||(e[10]=l("h1",{class:"mb-8"},"Продажи",-1)),n(M,{class:"position-relative",height:"500"},{default:s(()=>[n(r(W),{data:j.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),n(R,null,{default:s(()=>[n(_,{cols:"12",sm:"6"},{default:s(()=>[n(d,{label:"Начиная с даты",modelValue:r(p),"onUpdate:modelValue":e[0]||(e[0]=a=>k(p)?p.value=a:null)},null,8,["modelValue"])]),_:1}),n(_,{cols:"12",sm:"6"},{default:s(()=>[n(d,{label:"Заканчивая датой",modelValue:r(c),"onUpdate:modelValue":e[1]||(e[1]=a=>k(c)?c.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),n(R,null,{default:s(()=>[n(_,{cols:"12",md:"1",class:"d-flex align-center"},{default:s(()=>e[6]||(e[6]=[$("Полная сумма:")])),_:1,__:[6]}),n(_,null,{default:s(()=>[n(ue,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value=a),max:r(v),min:r(x),step:1,class:"align-center","hide-details":""},{prepend:s(()=>[n(E,{modelValue:u.value[0],"onUpdate:modelValue":e[2]||(e[2]=a=>u.value[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:s(()=>[n(E,{modelValue:u.value[1],"onUpdate:modelValue":e[3]||(e[3]=a=>u.value[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),r(N)!=null?(V(),le(M,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:s(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),n(te,{onClick:r(q)},{default:s(()=>e[7]||(e[7]=[$("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):B("",!0),r(N)==null?(V(),F(w,{key:1},[n(Z,{"fixed-header":"",striped:"even",class:"mt-8"},{default:s(()=>[e[9]||(e[9]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"ID"),l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Полная сумма"),l("th",null,"Скидка"),l("th",null,"Регион"),l("th",null,"Склад")])],-1)),l("tbody",null,[(V(!0),F(w,null,ne(P.value,a=>(V(),F("tr",null,[l("td",null,i(a.nm_id),1),l("td",null,i(a.sale_id),1),l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.region_name),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),l("div",oe,[n(G,{modelValue:r(m),"onUpdate:modelValue":e[5]||(e[5]=a=>k(m)?m.value=a:null),length:(f=r(b))==null?void 0:f.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):B("",!0)],64)}}});export{fe as default};
