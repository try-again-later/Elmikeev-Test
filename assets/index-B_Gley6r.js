import{a1 as me,a3 as b,a4 as x,d as O,ab as S,a8 as Z,ac as h,ad as ee,g as J,p as K,ae as ve,af as Ee,b as Q,c as o,ag as fe,ah as we,h as l,n as N,z as Oe,ai as Ie,f as oe,aj as re,i as ge,a as Ae,q as v,G as f,V as Pe,e as Fe,ak as ue,al as je,k as Be,l as Re,m as xe,v as $e,am as Le,w as Ue,an as ze,ao as Ge,o as qe,r as Me,t as He,ap as Je,aq as Ke,A as $,I as Qe,a2 as We,a9 as ie,a5 as u,a7 as T,ar as L,as as p,M as Xe,_ as E,a6 as U}from"./index-CLrJ2Pfw.js";import{u as ce,V as k,a as z,B as G,b as q}from"./VTable-BcTY476M.js";import{a as Ye,u as Ze}from"./useNProgress-DyL7y6SJ.js";import{o as de}from"./list-CphnuEVB.js";import"./toDate-CP9kJ8oq.js";function Y(t,a,e){return Ye(t,-a,e)}const et=me({__name:"PercentageChange",props:{change:{}},setup(t){return(a,e)=>(x(),b("span",{class:O({"text-red":a.change<0,"text-green":a.change>=0})},[S(h((a.change*100).toFixed(0))+"% ",1),a.change>=0?(x(),Z(ee,{key:0,icon:"mdi-arrow-top-right"})):(x(),Z(ee,{key:1,icon:"mdi-arrow-bottom-right"}))],2))}});function te(t){const a={};for(const e of t)e.nm_id in a?a[e.nm_id]+=1:a[e.nm_id]=1;return a}function tt(t){const a=te(t),e=Object.keys(a).map(n=>({partName:n,count:a[n]}));return e.sort((n,i)=>i.count-n.count),e}function nt(t,a){const e=te(t),n=te(a),i=new Set([...Object.keys(e),...Object.keys(n)]),d=[];for(const s of i)s in e&&s in n&&d.push({partName:s,previousOrderCount:e[s],currentOrderCount:n[s],change:(n[s]-e[s])/e[s]||0});return d.sort((s,m)=>m.change-s.change),d}function ne(t){const a={};for(const e of t)e.nm_id in a?a[e.nm_id]+=Number.parseFloat(e.total_price)||0:a[e.nm_id]=Number.parseFloat(e.total_price)||0;return a}function at(t){const a=ne(t),e=Object.keys(a).map(n=>({partName:n,totalPrice:a[n]}));return e.sort((n,i)=>i.totalPrice-n.totalPrice),e}function lt(t,a){const e=ne(t),n=ne(a),i=new Set([...Object.keys(e),...Object.keys(n)]),d=[];for(const s of i)s in e&&s in n&&d.push({partName:s,previousTotalPrice:e[s],currentTotalPrice:n[s],change:(n[s]-e[s])/e[s]||0});return d.sort((s,m)=>m.change-s.change),d}function ae(t){const a={};for(const e of t)e.is_cancel&&(e.nm_id in a?a[e.nm_id]+=1:a[e.nm_id]=1);return a}function ot(t){const a=ae(t),e=Object.keys(a).map(n=>({partName:n,cancelCount:a[n]}));return e.sort((n,i)=>i.cancelCount-n.cancelCount),e}function st(t,a){const e=ae(t),n=ae(a),i=new Set([...Object.keys(e),...Object.keys(n)]),d=[];for(const s of i)s in e&&s in n&&d.push({partName:s,previousCancelCount:e[s],currentCancelCount:n[s],change:(n[s]-e[s])/e[s]||0});return d.sort((s,m)=>m.change-s.change),d}function le(t){const a={};for(const e of t)e.nm_id in a?(a[e.nm_id].count+=1,a[e.nm_id].discountSum+=e.discount_percent):a[e.nm_id]={count:1,discountSum:e.discount_percent};return a}function rt(t){const a=le(t),e=Object.keys(a).map(n=>({partName:n,averageDiscount:a[n].discountSum/a[n].count}));return e.sort((n,i)=>i.averageDiscount-n.averageDiscount),e}function ut(t,a){const e=le(t),n=le(a),i=new Set([...Object.keys(e),...Object.keys(n)]),d=[];for(const s of i)if(s in e&&s in n){const m=e[s].discountSum/e[s].count,_=n[s].discountSum/n[s].count;d.push({partName:s,previousAverageDiscount:m,currentAverageDiscount:_,change:(_-m)/m||0})}return d.sort((s,m)=>m.change-s.change),d}const I=Symbol.for("vuetify:v-expansion-panel"),Ce=K({...oe(),...Ie()},"VExpansionPanelText"),w=J()({name:"VExpansionPanelText",props:Ce(),setup(t,a){let{slots:e}=a;const n=ve(I);if(!n)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:i,onAfterLeave:d}=Ee(t,n.isSelected);return Q(()=>o(Oe,{onAfterLeave:d},{default:()=>{var s;return[fe(l("div",{class:O(["v-expansion-panel-text",t.class]),style:N(t.style)},[e.default&&i.value&&l("div",{class:"v-expansion-panel-text__wrapper"},[(s=e.default)==null?void 0:s.call(e)])]),[[we,n.isSelected.value]])]}})),{}}}),he=K({color:String,expandIcon:{type:ue,default:"$expand"},collapseIcon:{type:ue,default:"$collapse"},hideActions:Boolean,focusable:Boolean,static:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean,...oe(),...Fe()},"VExpansionPanelTitle"),pe=J()({name:"VExpansionPanelTitle",directives:{vRipple:re},props:he(),setup(t,a){let{slots:e}=a;const n=ve(I);if(!n)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:i,backgroundColorStyles:d}=ge(()=>t.color),{dimensionStyles:s}=Ae(t),m=v(()=>({collapseIcon:t.collapseIcon,disabled:n.disabled.value,expanded:n.isSelected.value,expandIcon:t.expandIcon,readonly:t.readonly})),_=f(()=>n.isSelected.value?t.collapseIcon:t.expandIcon);return Q(()=>{var V;return fe(l("button",{class:O(["v-expansion-panel-title",{"v-expansion-panel-title--active":n.isSelected.value,"v-expansion-panel-title--focusable":t.focusable,"v-expansion-panel-title--static":t.static},i.value,t.class]),style:N([d.value,s.value,t.style]),type:"button",tabindex:n.disabled.value?-1:void 0,disabled:n.disabled.value,"aria-expanded":n.isSelected.value,onClick:t.readonly?void 0:n.toggle},[l("span",{class:"v-expansion-panel-title__overlay"},null),(V=e.default)==null?void 0:V.call(e,m.value),!t.hideActions&&o(Pe,{defaults:{VIcon:{icon:_.value}}},{default:()=>{var g;return[l("span",{class:"v-expansion-panel-title__icon"},[((g=e.actions)==null?void 0:g.call(e,m.value))??o(ee,null,null)])]}})]),[[re,t.ripple]])}),{}}}),be=K({title:String,text:String,bgColor:String,...Ue(),...Le(),...$e(),...xe(),...he(),...Ce()},"VExpansionPanel"),M=J()({name:"VExpansionPanel",props:be(),emits:{"group:selected":t=>!0},setup(t,a){let{slots:e}=a;const n=je(t,I),{backgroundColorClasses:i,backgroundColorStyles:d}=ge(()=>t.bgColor),{elevationClasses:s}=Be(t),{roundedClasses:m}=Re(t),_=f(()=>(n==null?void 0:n.disabled.value)||t.disabled),V=v(()=>n.group.items.value.reduce((y,C,A)=>(n.group.selected.value.includes(C.id)&&y.push(A),y),[])),g=v(()=>{const y=n.group.items.value.findIndex(C=>C.id===n.id);return!n.isSelected.value&&V.value.some(C=>C-y===1)}),W=v(()=>{const y=n.group.items.value.findIndex(C=>C.id===n.id);return!n.isSelected.value&&V.value.some(C=>C-y===-1)});return ze(I,n),Q(()=>{const y=!!(e.text||t.text),C=!!(e.title||t.title),A=pe.filterProps(t),F=w.filterProps(t);return o(t.tag,{class:O(["v-expansion-panel",{"v-expansion-panel--active":n.isSelected.value,"v-expansion-panel--before-active":g.value,"v-expansion-panel--after-active":W.value,"v-expansion-panel--disabled":_.value},m.value,i.value,t.class]),style:N([d.value,t.style])},{default:()=>[l("div",{class:O(["v-expansion-panel__shadow",...s.value])},null),o(Pe,{defaults:{VExpansionPanelTitle:{...A},VExpansionPanelText:{...F}}},{default:()=>{var D;return[C&&o(pe,{key:"title"},{default:()=>[e.title?e.title():t.title]}),y&&o(w,{key:"text"},{default:()=>[e.text?e.text():t.text]}),(D=e.default)==null?void 0:D.call(e)]}})]})}),{groupItem:n}}}),it=["default","accordion","inset","popout"],ct=K({flat:Boolean,...Ke(),...Je(be(),["bgColor","collapseIcon","color","eager","elevation","expandIcon","focusable","hideActions","readonly","ripple","rounded","tile","static"]),...He(),...oe(),...xe(),variant:{type:String,default:"default",validator:t=>it.includes(t)}},"VExpansionPanels"),H=J()({name:"VExpansionPanels",props:ct(),emits:{"update:modelValue":t=>!0},setup(t,a){let{slots:e}=a;const{next:n,prev:i}=Ge(t,I),{themeClasses:d}=qe(t),s=f(()=>t.variant&&`v-expansion-panels--variant-${t.variant}`);return Me({VExpansionPanel:{bgColor:f(()=>t.bgColor),collapseIcon:f(()=>t.collapseIcon),color:f(()=>t.color),eager:f(()=>t.eager),elevation:f(()=>t.elevation),expandIcon:f(()=>t.expandIcon),focusable:f(()=>t.focusable),hideActions:f(()=>t.hideActions),readonly:f(()=>t.readonly),ripple:f(()=>t.ripple),rounded:f(()=>t.rounded),static:f(()=>t.static)}}),Q(()=>o(t.tag,{class:O(["v-expansion-panels",{"v-expansion-panels--flat":t.flat,"v-expansion-panels--tile":t.tile},d.value,s.value,t.class]),style:N(t.style)},{default:()=>{var m;return[(m=e.default)==null?void 0:m.call(e,{prev:i,next:n})]}})),{next:n,prev:i}}}),gt=me({__name:"index",setup(t){const a=$(Y(new Date,7)),e=$(new Date),n=$(Y(new Date,15)),i=$(Y(new Date,8)),d=v(()=>de({dateFrom:a.value,dateTo:e.value,page:1,limit:500}).href),{execute:s,isFetching:m,error:_,data:V}=ce(d,{refetch:!0}).get().json(),g=v(()=>V.value==null?[]:V.value.data),W=v(()=>de({dateFrom:n.value,dateTo:i.value,page:1,limit:500}).href),{execute:y,isFetching:C,error:A,data:F}=ce(W,{refetch:!0}).get().json(),D=v(()=>F.value==null?[]:F.value.data),{isLoading:_e}=Ze();Qe(()=>{_e.value=m.value||C.value});const ye=v(()=>nt(D.value,g.value).slice(0,20)),Ve=v(()=>lt(D.value,g.value).slice(0,20)),ke=v(()=>st(D.value,g.value).slice(0,20)),Se=v(()=>ut(D.value,g.value).slice(0,20)),X=v(()=>[...new Set(g.value.map(P=>P.nm_id))]),j={responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{ticks:{display:!0,autoSkip:!1},position:"top"}}},Ne=v(()=>{const P=tt(g.value);return{labels:P.map(r=>r.partName),datasets:[{data:P.map(r=>r.count),label:"Количество продаж по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}}),De=v(()=>{const P=at(g.value);return{labels:P.map(r=>r.partName),datasets:[{data:P.map(r=>r.totalPrice),label:"Суммарная стоимость продаж по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}}),se=v(()=>{const P=ot(g.value);return{labels:P.map(r=>r.partName),datasets:[{data:P.map(r=>r.cancelCount),label:"Количество отмен по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}}),Te=v(()=>{const P=rt(g.value);return{labels:P.map(r=>r.partName),datasets:[{data:P.map(r=>r.averageDiscount),label:"Средняя скидка по каждому артикулу",backgroundColor:"rgb(255, 99, 132)"}]}});return(P,r)=>{const B=We("v-date-input"),R=et;return x(),b(E,null,[r[16]||(r[16]=l("h1",{class:"mb-8"},"Главная",-1)),o(T,{class:"mb-2"},{default:u(()=>r[4]||(r[4]=[S("Текущий период:")])),_:1,__:[4]}),o(z,null,{default:u(()=>[o(k,{cols:"12",sm:"6"},{default:u(()=>[o(B,{label:"Начиная с даты",modelValue:p(a),"onUpdate:modelValue":r[0]||(r[0]=c=>L(a)?a.value=c:null)},null,8,["modelValue"])]),_:1}),o(k,{cols:"12",sm:"6"},{default:u(()=>[o(B,{label:"Заканчивая датой",modelValue:p(e),"onUpdate:modelValue":r[1]||(r[1]=c=>L(e)?e.value=c:null)},null,8,["modelValue"])]),_:1})]),_:1}),o(T,{class:"mb-2"},{default:u(()=>r[5]||(r[5]=[S("Предыдущий период:")])),_:1,__:[5]}),o(z,null,{default:u(()=>[o(k,{cols:"12",sm:"6"},{default:u(()=>[o(B,{label:"Начиная с даты",modelValue:p(n),"onUpdate:modelValue":r[2]||(r[2]=c=>L(n)?n.value=c:null)},null,8,["modelValue"])]),_:1}),o(k,{cols:"12",sm:"6"},{default:u(()=>[o(B,{label:"Заканчивая датой",modelValue:p(i),"onUpdate:modelValue":r[3]||(r[3]=c=>L(i)?i.value=c:null)},null,8,["modelValue"])]),_:1})]),_:1}),p(_)!=null?(x(),Z(T,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:u(()=>[r[7]||(r[7]=l("p",null,"Ошибка при загрузке данных",-1)),o(Xe,{onClick:p(s)},{default:u(()=>r[6]||(r[6]=[S("Попробовать ещё раз")])),_:1,__:[6]},8,["onClick"])]),_:1,__:[7]})):ie("",!0),p(_)==null?(x(),b(E,{key:1},[o(z,null,{default:u(()=>[o(k,{cols:"12",sm:"6",class:"position-relative"},{default:u(()=>[o(H,null,{default:u(()=>[o(M,{title:"Количество продаж по каждому артикулу"},{default:u(()=>[o(w,null,{default:u(()=>[l("div",{style:N(`position: relative; height: ${p(X).length*20}px; width: 100%`)},[o(p(G),{data:p(Ne),options:j},null,8,["data"])],4),o(T,{class:"my-2"},{default:u(()=>r[8]||(r[8]=[S("Топ 20 изменений по продажам:")])),_:1,__:[8]}),o(q,null,{default:u(()=>[r[9]||(r[9]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"Количество продаж в предыдущем периоде"),l("th",null,"Количество продаж в текущем периоде"),l("th",null,"Процент изменения")])],-1)),l("tbody",null,[(x(!0),b(E,null,U(p(ye),c=>(x(),b("tr",null,[l("td",null,h(c.partName),1),l("td",null,h(c.previousOrderCount),1),l("td",null,h(c.currentOrderCount),1),l("td",null,[o(R,{change:c.change},null,8,["change"])])]))),256))])]),_:1,__:[9]})]),_:1})]),_:1})]),_:1})]),_:1}),o(k,{cols:"12",sm:"6",class:"position-relative"},{default:u(()=>[o(H,null,{default:u(()=>[o(M,{title:"Суммарная стоимость продаж по каждому артикулу"},{default:u(()=>[o(w,null,{default:u(()=>[l("div",{style:N(`position: relative; height: ${p(X).length*20}px; width: 100%`)},[o(p(G),{data:p(De),options:j},null,8,["data"])],4),o(T,{class:"my-2"},{default:u(()=>r[10]||(r[10]=[S(" Топ 20 изменений по суммарной стоимости продаж: ")])),_:1,__:[10]}),o(q,null,{default:u(()=>[r[11]||(r[11]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"Сумма за предыдущий период"),l("th",null,"Сумма за текущий период"),l("th",null,"Процент изменения")])],-1)),l("tbody",null,[(x(!0),b(E,null,U(p(Ve),c=>(x(),b("tr",null,[l("td",null,h(c.partName),1),l("td",null,h(c.previousTotalPrice.toFixed(2)),1),l("td",null,h(c.currentTotalPrice.toFixed(2)),1),l("td",null,[o(R,{change:c.change},null,8,["change"])])]))),256))])]),_:1,__:[11]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(z,null,{default:u(()=>[o(k,{cols:"12",sm:"6",class:"position-relative"},{default:u(()=>[o(H,null,{default:u(()=>[o(M,{title:"Количество отмен по каждому артикулу"},{default:u(()=>[o(w,null,{default:u(()=>[l("div",{style:N(`position: relative; height: ${p(se).datasets[0].data.length*20}px; width: 100%`)},[o(p(G),{data:p(se),options:j},null,8,["data"])],4),o(T,{class:"my-2"},{default:u(()=>r[12]||(r[12]=[S(" Топ 20 изменений по количеству отмен: ")])),_:1,__:[12]}),o(q,null,{default:u(()=>[r[13]||(r[13]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"Отмен за предыдущий период"),l("th",null,"Отмен за текущий период"),l("th",null,"Процент изменения")])],-1)),l("tbody",null,[(x(!0),b(E,null,U(p(ke),c=>(x(),b("tr",null,[l("td",null,h(c.partName),1),l("td",null,h(c.previousCancelCount),1),l("td",null,h(c.currentCancelCount),1),l("td",null,[o(R,{change:c.change},null,8,["change"])])]))),256))])]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})]),_:1}),o(k,{cols:"12",sm:"6",class:"position-relative"},{default:u(()=>[o(H,null,{default:u(()=>[o(M,{title:"Средняя скидка по каждому артикулу"},{default:u(()=>[o(w,null,{default:u(()=>[l("div",{style:N(`position: relative; height: ${p(X).length*20}px; width: 100%`)},[o(p(G),{data:p(Te),options:j},null,8,["data"])],4),o(T,{class:"my-2"},{default:u(()=>r[14]||(r[14]=[S(" Топ 20 изменений по средней скидке: ")])),_:1,__:[14]}),o(q,null,{default:u(()=>[r[15]||(r[15]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"Средняя скидка за предыдущий период"),l("th",null,"Средняя скидка за текущий период"),l("th",null,"Процент изменения")])],-1)),l("tbody",null,[(x(!0),b(E,null,U(p(Se),c=>(x(),b("tr",null,[l("td",null,h(c.partName),1),l("td",null,h(c.previousAverageDiscount.toFixed(2)),1),l("td",null,h(c.currentAverageDiscount.toFixed(2)),1),l("td",null,[o(R,{change:c.change},null,8,["change"])])]))),256))])]),_:1,__:[15]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64)):ie("",!0)],64)}}});export{gt as default};
