import{d as S,u as j,a as z,B as I,V as b,b as C,c as W,e as Z}from"./VTable-BaN9w69I.js";import{u as G,s as H,a as J}from"./useNProgress-D76amKe5.js";import{aa as K,A as f,a1 as O,ab as X,C as x,q as k,a2 as ee,a3 as w,a4 as y,h as t,c as l,a8 as ae,a9 as U,a5 as o,ac as n,a7 as B,ad as _,ae as M,af as N,M as te,_ as T,a6 as le,ag as V}from"./index-TBuvqor5.js";import{V as ne}from"./VRangeSlider-CVPHYtP_.js";function se(p){const d=new URL("https://elmikeev.185-236-23-37.sslip.io/api/incomes");return d.searchParams.append("dateFrom",S(p.dateFrom)),d.searchParams.append("dateTo",S(p.dateTo)),d.searchParams.append("page",p.page.toString()),d.searchParams.append("limit",p.limit.toString()),d.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),d}const ue=K("filters",()=>{const p=f(null),d=f(null),r=f(null),i=f(null);return{dateFrom:p,dateTo:d,page:r,quantityRange:i}}),oe={class:"text-center"},pe=O({__name:"incomes",setup(p){const d=ue(),{dateFrom:r,dateTo:i}=X(d);G(r,i);const c=j("page","1",{transform:Number});x(r,()=>{c.value=1}),x(i,()=>{c.value=1});const P=H(new Date),A=new Date,E=k(()=>se({dateFrom:r.value??P,dateTo:i.value??A,page:c.value,limit:100}).href),{execute:L,isFetching:Q,error:D,data:h}=z(E,{refetch:!0}).get().json(),{isLoading:$}=J();x(Q,s=>{$.value=s});const F=f(0),v=f(0),u=f([F.value,v.value]);x(h,s=>{if(s!=null){const e=u.value[1]==v.value;F.value=0,v.value=Math.max(Math.ceil(s.data.reduce((m,g)=>Math.max(m,g.quantity),0)),v.value),(u.value[1]==0||e)&&(u.value[1]=v.value)}});const q=k(()=>h.value==null?[]:h.value.data.filter(s=>u.value[0]<=s.quantity&&s.quantity<=u.value[1])),Y=k(()=>{const s=[...new Set(q.value.map(m=>m.warehouse_name))],e=[];for(const m of s){const g=q.value.reduce((a,R)=>(R.warehouse_name==m?R.quantity:0)+a,0);e.push(g)}return{labels:s,datasets:[{data:e,label:"Суммарное количество в каждом складе",backgroundColor:"rgb(255, 99, 132)"}]}});return(s,e)=>{var g;const m=ee("v-date-input");return y(),w(T,null,[e[10]||(e[10]=t("h1",{class:"mb-8"},"Доходы",-1)),l(B,{class:"position-relative",height:"500"},{default:o(()=>[l(n(I),{data:Y.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),l(C,null,{default:o(()=>[l(b,{cols:"12",sm:"6"},{default:o(()=>[l(m,{label:"Начиная с даты",modelValue:n(r),"onUpdate:modelValue":e[0]||(e[0]=a=>_(r)?r.value=a:null)},null,8,["modelValue"])]),_:1}),l(b,{cols:"12",sm:"6"},{default:o(()=>[l(m,{label:"Заканчивая датой",modelValue:n(i),"onUpdate:modelValue":e[1]||(e[1]=a=>_(i)?i.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),l(C,null,{default:o(()=>[l(b,{cols:"12",md:"1",class:"d-flex align-center"},{default:o(()=>e[6]||(e[6]=[M("Фильтр по количеству:")])),_:1,__:[6]}),l(b,null,{default:o(()=>[l(ne,{modelValue:n(u),"onUpdate:modelValue":e[4]||(e[4]=a=>_(u)?u.value=a:null),max:n(v),min:n(F),step:1,class:"align-center","hide-details":""},{prepend:o(()=>[l(N,{modelValue:n(u)[0],"onUpdate:modelValue":e[2]||(e[2]=a=>n(u)[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:o(()=>[l(N,{modelValue:n(u)[1],"onUpdate:modelValue":e[3]||(e[3]=a=>n(u)[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),n(D)!=null?(y(),ae(B,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:o(()=>[e[8]||(e[8]=t("p",null,"Ошибка при загрузке данных",-1)),l(te,{onClick:n(L)},{default:o(()=>e[7]||(e[7]=[M("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):U("",!0),n(D)==null?(y(),w(T,{key:1},[l(W,{"fixed-header":"",striped:"even",class:"mt-8"},{default:o(()=>[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Артикул"),t("th",null,"Штрих-код"),t("th",null,"Дата"),t("th",null,"Дата закрытия"),t("th",null,"Количество"),t("th",null,"Склад")])],-1)),t("tbody",null,[(y(!0),w(T,null,le(q.value,a=>(y(),w("tr",null,[t("td",null,V(a.nm_id),1),t("td",null,V(a.barcode),1),t("td",null,V(a.date),1),t("td",null,V(a.date_close),1),t("td",null,V(a.quantity),1),t("td",null,V(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),t("div",oe,[l(Z,{modelValue:n(c),"onUpdate:modelValue":e[5]||(e[5]=a=>_(c)?c.value=a:null),length:(g=n(h))==null?void 0:g.meta.last_page,density:s.$vuetify.display.smAndDown?"compact":"default","total-visible":s.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):U("",!0)],64)}}});export{pe as default};
