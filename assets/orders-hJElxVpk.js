import{d as A,u as L,a as G,B as H,V as Q,b as J,c as x,e as K,f as X}from"./VTable-BBAIEy65.js";import{u as ee,s as le,a as ae}from"./useNProgress-qE7RV3QV.js";import{u as te}from"./orderFilters-DsFnte0q.js";import{a1 as ue,C as S,q as C,A as g,I as ne,a2 as se,a3 as D,a4 as c,h as l,c as o,a8 as oe,a9 as _,ab as n,a5 as h,ac as w,ad as q,M as R,a7 as re,_ as T,a6 as de,af as i}from"./index-CF-3AlnE.js";import"./VList-mZnB43ia.js";import"./format-BTd_LOVW.js";function ie(F){const u=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return u.searchParams.append("dateFrom",A(F.dateFrom)),u.searchParams.append("dateTo",A(F.dateTo)),u.searchParams.append("page",F.page.toString()),u.searchParams.append("limit",F.limit.toString()),u.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),u}const me={style:{position:"relative",height:"500px",width:"100%"}},ve={class:"d-flex align-center ga-4"},pe={class:"text-center"},Fe=ue({__name:"orders",setup(F){const u=te(),{dateFrom:V,dateTo:b}=ee(),m=L("page","1",{transform:Number});S(V,()=>{m.value=1}),S(b,()=>{m.value=1});const j=le(new Date),M=new Date,Y=C(()=>ie({dateFrom:V.value??j,dateTo:b.value??M,page:m.value,limit:100}).href),{execute:z,isFetching:I,error:B,data:y}=G(Y,{refetch:!0}).get().json(),{isLoading:O}=ae();S(I,t=>{O.value=t});const r=g([]),N=L("warehouses",null),d=C({get(){return N.value==null?r.value:N.value.split(",")},set(t){t.length==r.value.length?N.value=null:N.value=t.join(",")}}),P=g([]),v=g(u.partNamesFilter),E=g([]),p=g(u.brandFilter),$=g([]),f=g(u.categoryFilter);ne(()=>{u.dateFrom=V.value,u.dateTo=b.value,u.page=m.value,r.value.length!=d.value.length?u.warehouseNamesFilter=d.value:u.warehouseNamesFilter=null,u.partNamesFilter=v.value,u.brandFilter=p.value,u.categoryFilter=f.value}),S(y,t=>{if(t!=null){const e=r.value.length==d.value.length;r.value=[...new Set([...t.data.map(s=>s.warehouse_name),...r.value])],(d.value.length==0||e)&&(d.value=r.value),P.value=[...new Set([...t.data.map(s=>s.nm_id),...v.value])],E.value=[...new Set([...t.data.map(s=>s.brand),...p.value])],$.value=[...new Set([...t.data.map(s=>s.category),...f.value])]}});const U=C(()=>y.value==null?[]:y.value.data.filter(t=>d.value.includes(t.warehouse_name)&&(v.value.length==0||v.value.includes(t.nm_id))&&(p.value.length==0||p.value.includes(t.brand))&&(f.value.length==0||f.value.includes(t.category)))),W=C(()=>{const t=[...new Set(U.value.map(s=>s.warehouse_name))],e=[];for(const s of t){const k=U.value.reduce((a,Z)=>(Z.warehouse_name==s?1:0)+a,0);e.push(k)}return{labels:t,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var k;const s=se("v-date-input");return c(),D(T,null,[e[18]||(e[18]=l("h1",{class:"mb-8"},"Заказы",-1)),l("div",me,[o(n(H),{data:W.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),o(J,null,{default:h(()=>[o(Q,{cols:"12",sm:"6"},{default:h(()=>[o(s,{label:"Начиная с даты",modelValue:n(V),"onUpdate:modelValue":e[0]||(e[0]=a=>w(V)?V.value=a:null)},null,8,["modelValue"])]),_:1}),o(Q,{cols:"12",sm:"6"},{default:h(()=>[o(s,{label:"Заканчивая датой",modelValue:n(b),"onUpdate:modelValue":e[1]||(e[1]=a=>w(b)?b.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),l("div",ve,[o(R,{disabled:d.value.length==n(r).length,onClick:e[2]||(e[2]=a=>d.value=n(r))},{default:h(()=>e[8]||(e[8]=[q("Сбросить")])),_:1,__:[8]},8,["disabled"]),o(x,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),items:n(r),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),n(B)!=null?(c(),oe(re,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:h(()=>[e[10]||(e[10]=l("p",null,"Ошибка при загрузке данных",-1)),o(R,{onClick:n(z)},{default:h(()=>e[9]||(e[9]=[q("Попробовать ещё раз")])),_:1,__:[9]},8,["onClick"])]),_:1,__:[10]})):_("",!0),n(B)==null?(c(),D(T,{key:1},[o(K,{"fixed-header":"",striped:"even",class:"mt-8"},{default:h(()=>[l("thead",null,[l("tr",null,[l("th",null,[o(x,{modelValue:n(v),"onUpdate:modelValue":e[4]||(e[4]=a=>w(v)?v.value=a:null),items:n(P),"min-width":"200","max-width":"400",label:"Артикул",multiple:""},null,8,["modelValue","items"])]),e[11]||(e[11]=l("th",null,"Штрих-код",-1)),e[12]||(e[12]=l("th",null,"Дата",-1)),l("th",null,[o(x,{modelValue:n(p),"onUpdate:modelValue":e[5]||(e[5]=a=>w(p)?p.value=a:null),items:n(E),"min-width":"200","max-width":"400",label:"Брэнд",multiple:""},null,8,["modelValue","items"])]),l("th",null,[o(x,{modelValue:n(f),"onUpdate:modelValue":e[6]||(e[6]=a=>w(f)?f.value=a:null),items:n($),"min-width":"200","max-width":"400",label:"Категория",multiple:""},null,8,["modelValue","items"])]),e[13]||(e[13]=l("th",null,"Полная сумма",-1)),e[14]||(e[14]=l("th",null,"Скидка",-1)),e[15]||(e[15]=l("th",null,"Отменён",-1)),e[16]||(e[16]=l("th",null,"Регион",-1)),e[17]||(e[17]=l("th",null,"Склад",-1))])]),l("tbody",null,[(c(!0),D(T,null,de(U.value,a=>(c(),D("tr",null,[l("td",null,i(a.nm_id),1),l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(a.brand),1),l("td",null,i(a.category),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.is_cancel?"Да":"Нет"),1),l("td",null,i(a.oblast),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1}),l("div",pe,[o(X,{modelValue:n(m),"onUpdate:modelValue":e[7]||(e[7]=a=>w(m)?m.value=a:null),length:(k=n(y))==null?void 0:k.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):_("",!0)],64)}}});export{Fe as default};
