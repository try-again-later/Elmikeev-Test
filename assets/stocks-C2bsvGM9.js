import{d as W,u as L,V as F,P as A,a as E}from"./Request-BA6AlAT3.js";import{u as D,V as w,a as $,b as I}from"./VTable-jvydNw2X.js";import{u as O}from"./stockFilters-CUVD2nnZ.js";import{s as Y}from"./VList-Cwj9uxV4.js";import{a1 as j,q as c,A as g,I as z,C as Z,a3 as _,a4 as C,h as t,c as u,a9 as G,a5 as p,ar as r,_ as S,aq as k,a6 as H,at as s}from"./index-Biun5NIw.js";import"./toDate-CP9kJ8oq.js";function J(o){return Y(Date.now(),o)}function K(o){const n=new URL("https://elmikeev.185-236-23-37.sslip.io/api/stocks");return n.searchParams.append("dateFrom",W(o.dateFrom)),n.searchParams.append("dateTo",W(o.dateTo)),n.searchParams.append("page",o.page.toString()),n.searchParams.append("limit",o.limit.toString()),n.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),n}const M={class:"text-center"},ue=j({__name:"stocks",setup(o){const n=O(),b=D("page","1",{transform:Number}),q=c(()=>K({dateFrom:J(),dateTo:new Date,page:b.value,limit:100}).href),{error:B,data:h}=L(q,{refetch:!0}).get().json(),T=D("in-way-to-client","Не важно"),v=c({get(){return T.value},set(l){T.value=l}}),N=D("in-way-from-client","Не важно"),f=c({get(){return N.value},set(l){N.value=l}}),U=g([]),i=g(n.partNamesFilter),x=g([]),d=g(n.brandFilter),P=g([]),m=g(n.categoryFilter);z(()=>{n.page=b.value,n.inWayFromClient=f.value,n.inWayToClient=v.value,n.partNamesFilter=i.value,n.brandFilter=d.value,n.categoryFilter=m.value}),Z(h,l=>{l!=null&&(U.value=[...new Set([...l.data.map(e=>e.nm_id),...i.value])],x.value=[...new Set([...l.data.map(e=>e.brand),...d.value])],P.value=[...new Set([...l.data.map(e=>e.category),...m.value])])});const V=c(()=>h.value==null?[]:h.value.data.filter(l=>{let e=!0;return v.value!="Не важно"&&e&&(e=v.value=="Да"&&l.in_way_to_client||v.value=="Нет"&&!l.in_way_to_client),f.value!="Не важно"&&e&&(e=f.value=="Да"&&l.in_way_from_client||f.value=="Нет"&&!l.in_way_from_client),e&&(e=(i.value.length==0||i.value.includes(l.nm_id))&&(d.value.length==0||d.value.includes(l.brand))&&(m.value.length==0||m.value.includes(l.category))),e})),Q=c(()=>{const l=[0,0];return l[0]=V.value.reduce((e,y)=>e+(y.in_way_to_client?1:0),0),l[1]=V.value.length-l[0],l}),R=c(()=>{const l=[0,0];return l[0]=V.value.reduce((e,y)=>e+(y.in_way_from_client?1:0),0),l[1]=V.value.length-l[0],l});return(l,e)=>{var y;return C(),_(S,null,[e[12]||(e[12]=t("h1",{class:"mb-8"},"Склады",-1)),u(E,null,{default:p(()=>[u(F,{cols:"12",sm:"6",class:"position-relative",height:"500"},{default:p(()=>[u(r(A),{data:{labels:["Да","Нет"],datasets:[{label:"В пути к клиенту",data:Q.value,backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"В пути к клиенту"}}}},null,8,["data"])]),_:1}),u(F,{cols:"12",sm:"6",class:"position-relative",height:"500"},{default:p(()=>[u(r(A),{data:{labels:["Да","Нет"],datasets:[{label:"В пути от клиента",data:R.value,backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"В пути от клиента"}}}},null,8,["data"])]),_:1})]),_:1}),u(E,null,{default:p(()=>[u(F,{cols:"12",sm:"6"},{default:p(()=>[u(w,{label:"В пути к клиенту",modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),items:["Да","Нет","Не важно"]},null,8,["modelValue"])]),_:1}),u(F,{cols:"12",sm:"6"},{default:p(()=>[u(w,{label:"В пути от клиента",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),items:["Да","Нет","Не важно"]},null,8,["modelValue"])]),_:1})]),_:1}),r(B)==null?(C(),_(S,{key:0},[u($,{"fixed-header":"",striped:"even",class:"mt-8"},{default:p(()=>[t("thead",null,[t("tr",null,[t("th",null,[u(w,{modelValue:r(i),"onUpdate:modelValue":e[2]||(e[2]=a=>k(i)?i.value=a:null),items:r(U),"min-width":"200","max-width":"400",label:"Артикул",multiple:""},null,8,["modelValue","items"])]),e[6]||(e[6]=t("th",null,"Штрих-код",-1)),e[7]||(e[7]=t("th",null,"Дата",-1)),t("th",null,[u(w,{modelValue:r(d),"onUpdate:modelValue":e[3]||(e[3]=a=>k(d)?d.value=a:null),items:r(x),"min-width":"200","max-width":"400",label:"Брэнд",multiple:""},null,8,["modelValue","items"])]),t("th",null,[u(w,{modelValue:r(m),"onUpdate:modelValue":e[4]||(e[4]=a=>k(m)?m.value=a:null),items:r(P),"min-width":"200","max-width":"400",label:"Категория",multiple:""},null,8,["modelValue","items"])]),e[8]||(e[8]=t("th",null,"Склад",-1)),e[9]||(e[9]=t("th",null,"Стоимость",-1)),e[10]||(e[10]=t("th",null,"В пути к клиенту",-1)),e[11]||(e[11]=t("th",null,"В пути от клиента",-1))])]),t("tbody",null,[(C(!0),_(S,null,H(V.value,a=>(C(),_("tr",null,[t("td",null,s(a.nm_id),1),t("td",null,s(a.barcode),1),t("td",null,s(a.date),1),t("td",null,s(a.brand),1),t("td",null,s(a.category),1),t("td",null,s(a.warehouse_name),1),t("td",null,s(a.price??0),1),t("td",null,s(a.in_way_to_client?"Да":"Нет"),1),t("td",null,s(a.in_way_from_client?"Да":"Нет"),1)]))),256))])]),_:1}),t("div",M,[u(I,{modelValue:r(b),"onUpdate:modelValue":e[5]||(e[5]=a=>k(b)?b.value=a:null),length:(y=r(h))==null?void 0:y.meta.last_page,density:l.$vuetify.display.smAndDown?"compact":"default","total-visible":l.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):G("",!0)],64)}}});export{ue as default};
