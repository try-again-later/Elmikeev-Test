import{au as J,A as l,q as i,I as K}from"./index-DNGCdE2A.js";import{u as k}from"./VSelect-CZvNPAFw.js";import{o as T}from"./list-D4vBaKEv.js";import{a as M}from"./useNProgress-ZYdIUDHV.js";function h(c,r,e){return M(c,-r,e)}function O(c){const r={};for(const e of c)e.nm_id in r?r[e.nm_id]+=1:r[e.nm_id]=1;return r}function Z(c){const r=O(c),e=Object.keys(r).map(n=>({partName:n,count:r[n]}));return e.sort((n,a)=>a.count-n.count),e}function $(c,r){const e=O(c),n=O(r),a=new Set([...Object.keys(e),...Object.keys(n)]),s=[];for(const t of a)t in e&&t in n&&s.push({partName:t,previousOrderCount:e[t],currentOrderCount:n[t],change:(n[t]-e[t])/e[t]||0});return s.sort((t,u)=>u.change-t.change),s}const ee=J("orderPeriodChanges",()=>{const c=l(h(new Date,7)),r=l(new Date),e=l(h(new Date,15)),n=l(h(new Date,8)),a=i(()=>T({dateFrom:c.value,dateTo:r.value,page:1,limit:500}).href),{execute:s,isFetching:t,error:u,data:P}=k(a,{refetch:!0}).get().json(),d=i(()=>P.value==null?[]:P.value.data),E=i(()=>T({dateFrom:e.value,dateTo:n.value,page:1,limit:500}).href),{execute:x,isFetching:A,error:R,data:D}=k(E,{refetch:!0}).get().json(),m=i(()=>D.value==null?[]:D.value.data),y=l(!1);K(()=>{y.value=t.value||A.value});const I=i(()=>u.value!=null||R.value!=null),U=()=>{s(),x()},q=i(()=>[...new Set([...m.value.map(o=>o.nm_id),...d.value.map(o=>o.nm_id)])]),v=l([]),F=o=>v.value.length==0||v.value.includes(o.nm_id),B=i(()=>[...new Set([...m.value.map(o=>o.category),...d.value.map(o=>o.category)])]),p=l([]),S=o=>p.value.length==0||p.value.includes(o.category),L=i(()=>[...new Set([...m.value.map(o=>o.brand),...d.value.map(o=>o.brand)])]),g=l([]),j=o=>g.value.length==0||g.value.includes(o.brand),z=i(()=>[...new Set([...m.value.map(o=>o.oblast),...d.value.map(o=>o.oblast)])]),C=l([]),w=o=>C.value.length==0||C.value.includes(o.oblast),G=i(()=>d.value.filter(o=>F(o)&&S(o)&&j(o)&&w(o))),H=i(()=>m.value.filter(o=>F(o)&&S(o)&&j(o)&&w(o)));return{currentPeriodDateFrom:c,currentPeriodDateTo:r,previousPeriodDateFrom:e,previousPeriodDateTo:n,isFetching:y,hasError:I,retry:U,currentPeriodOrders:G,previousPeriodOrders:H,getOrder:o=>{for(const f of d.value.reverse())if(f.nm_id==o)return f;for(const f of m.value.reverse())if(f.nm_id==o)return f;return null},allPartNames:q,partNamesFilter:v,allCategories:B,categoryFilter:p,allBrands:L,brandFilter:g,allRegions:z,regionFilter:C}});function b(c){const r={};for(const e of c)e.nm_id in r?r[e.nm_id]+=Number.parseFloat(e.total_price)||0:r[e.nm_id]=Number.parseFloat(e.total_price)||0;return r}function re(c){const r=b(c),e=Object.keys(r).map(n=>({partName:n,totalPrice:r[n]}));return e.sort((n,a)=>a.totalPrice-n.totalPrice),e}function te(c,r){const e=b(c),n=b(r),a=new Set([...Object.keys(e),...Object.keys(n)]),s=[];for(const t of a)t in e&&t in n&&s.push({partName:t,previousTotalPrice:e[t],currentTotalPrice:n[t],change:(n[t]-e[t])/e[t]||0});return s.sort((t,u)=>u.change-t.change),s}function N(c){const r={};for(const e of c)e.is_cancel&&(e.nm_id in r?r[e.nm_id]+=1:r[e.nm_id]=1);return r}function ne(c){const r=N(c),e=Object.keys(r).map(n=>({partName:n,cancelCount:r[n]}));return e.sort((n,a)=>a.cancelCount-n.cancelCount),e}function oe(c,r){const e=N(c),n=N(r),a=new Set([...Object.keys(e),...Object.keys(n)]),s=[];for(const t of a)t in e&&t in n&&s.push({partName:t,previousCancelCount:e[t],currentCancelCount:n[t],change:(n[t]-e[t])/e[t]||0});return s.sort((t,u)=>u.change-t.change),s}function _(c){const r={};for(const e of c)e.nm_id in r?(r[e.nm_id].count+=1,r[e.nm_id].discountSum+=e.discount_percent):r[e.nm_id]={count:1,discountSum:e.discount_percent};return r}function ce(c){const r=_(c),e=Object.keys(r).map(n=>({partName:n,averageDiscount:r[n].discountSum/r[n].count}));return e.sort((n,a)=>a.averageDiscount-n.averageDiscount),e}function ae(c,r){const e=_(c),n=_(r),a=new Set([...Object.keys(e),...Object.keys(n)]),s=[];for(const t of a)if(t in e&&t in n){const u=e[t].discountSum/e[t].count,P=n[t].discountSum/n[t].count;s.push({partName:t,previousAverageDiscount:u,currentAverageDiscount:P,change:(P-u)/u||0})}return s.sort((t,u)=>u.change-t.change),s}export{re as a,ne as b,ce as c,$ as d,te as e,oe as f,ae as g,Z as o,ee as u};
