import{d as D,u as M,a as Y,B as j,V as N,b as z,c as O,e as W}from"./VTable-BaN9w69I.js";import{u as S,s as Z,a as G}from"./useNProgress-D76amKe5.js";import{aa as H,A as h,a1 as I,ab as J,C as b,q as k,a2 as K,a3 as w,a4 as g,h as a,c as n,a8 as X,a9 as T,ac as t,a5 as f,ad as F,ae as B,M as P,a7 as ee,_ as C,a6 as ae,ag as m}from"./index-TBuvqor5.js";import{V as le}from"./VSelect-D2cKK90a.js";import"./VList-0_CkyHIK.js";function te(p){const o=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return o.searchParams.append("dateFrom",D(p.dateFrom)),o.searchParams.append("dateTo",D(p.dateTo)),o.searchParams.append("page",p.page.toString()),o.searchParams.append("limit",p.limit.toString()),o.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),o}const se=H("filters",()=>{const p=h(null),o=h(null),u=h(null),r=h(null);return{dateFrom:p,dateTo:o,page:u,warehouseNamesFilter:r}}),ne={style:{position:"relative",height:"500px",width:"100%"}},oe={class:"d-flex align-center ga-4"},ue={class:"text-center"},ce=I({__name:"orders",setup(p){const o=se(),{dateFrom:u,dateTo:r}=J(o);S(u,r),S(u,r);const v=M("page","1",{transform:Number});b(u,()=>{v.value=1}),b(r,()=>{v.value=1});const R=Z(new Date),U=new Date,$=k(()=>te({dateFrom:u.value??R,dateTo:r.value??U,page:v.value,limit:100}).href),{execute:A,isFetching:E,error:x,data:V}=Y($,{refetch:!0}).get().json(),{isLoading:L}=G();b(E,s=>{L.value=s});const c=h([]),d=h([]);b(V,s=>{if(s!=null){const e=c.value.length==d.value.length;c.value=[...new Set([...s.data.map(i=>i.warehouse_name),...c.value])],(d.value.length==0||e)&&(d.value=c.value)}});const y=k(()=>V.value==null?[]:V.value.data.filter(s=>d.value.includes(s.warehouse_name))),q=k(()=>{const s=[...new Set(y.value.map(i=>i.warehouse_name))],e=[];for(const i of s){const _=y.value.reduce((l,Q)=>(Q.warehouse_name==i?1:0)+l,0);e.push(_)}return{labels:s,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(s,e)=>{var _;const i=K("v-date-input");return g(),w(C,null,[e[9]||(e[9]=a("h1",{class:"mb-8"},"Заказы",-1)),a("div",ne,[n(t(j),{data:q.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),n(z,null,{default:f(()=>[n(N,{cols:"12",sm:"6"},{default:f(()=>[n(i,{label:"Начиная с даты",modelValue:t(u),"onUpdate:modelValue":e[0]||(e[0]=l=>F(u)?u.value=l:null)},null,8,["modelValue"])]),_:1}),n(N,{cols:"12",sm:"6"},{default:f(()=>[n(i,{label:"Заканчивая датой",modelValue:t(r),"onUpdate:modelValue":e[1]||(e[1]=l=>F(r)?r.value=l:null)},null,8,["modelValue"])]),_:1})]),_:1}),a("div",oe,[n(P,{disabled:t(d).length==t(c).length,onClick:e[2]||(e[2]=l=>d.value=t(c))},{default:f(()=>e[5]||(e[5]=[B("Сбросить")])),_:1,__:[5]},8,["disabled"]),n(le,{modelValue:t(d),"onUpdate:modelValue":e[3]||(e[3]=l=>F(d)?d.value=l:null),items:t(c),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),t(x)!=null?(g(),X(ee,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:f(()=>[e[7]||(e[7]=a("p",null,"Ошибка при загрузке данных",-1)),n(P,{onClick:t(A)},{default:f(()=>e[6]||(e[6]=[B("Попробовать ещё раз")])),_:1,__:[6]},8,["onClick"])]),_:1,__:[7]})):T("",!0),t(x)==null?(g(),w(C,{key:1},[n(O,{"fixed-header":"",striped:"even",class:"mt-8"},{default:f(()=>[e[8]||(e[8]=a("thead",null,[a("tr",null,[a("th",null,"Артикул"),a("th",null,"Штрих-код"),a("th",null,"Дата"),a("th",null,"Полная сумма"),a("th",null,"Скидка"),a("th",null,"Отменён"),a("th",null,"Регион"),a("th",null,"Склад")])],-1)),a("tbody",null,[(g(!0),w(C,null,ae(y.value,l=>(g(),w("tr",null,[a("td",null,m(l.nm_id),1),a("td",null,m(l.barcode),1),a("td",null,m(l.date),1),a("td",null,m(parseFloat(l.total_price).toFixed(2)),1),a("td",null,m(`${l.discount_percent}%`),1),a("td",null,m(l.is_cancel?"Да":"Нет"),1),a("td",null,m(l.oblast),1),a("td",null,m(l.warehouse_name),1)]))),256))])]),_:1,__:[8]}),a("div",ue,[n(W,{modelValue:t(v),"onUpdate:modelValue":e[4]||(e[4]=l=>F(v)?v.value=l:null),length:(_=t(V))==null?void 0:_.meta.last_page,density:s.$vuetify.display.smAndDown?"compact":"default","total-visible":s.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):T("",!0)],64)}}});export{ce as default};
