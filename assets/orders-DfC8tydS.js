import{d as x,u as D,a as j,B as M,V as S,b as Y,c as z,e as I}from"./VTable-ExvP3wOF.js";import{u as O,s as W,a as Z}from"./useNProgress-hu3Nmi4V.js";import{u as G}from"./orderFilters-CWNgdyH3.js";import{a1 as H,C as _,q as b,A as J,I as K,a2 as X,a3 as F,a4 as h,h as l,c as n,a8 as ee,a9 as T,ab as u,a5 as p,ac as k,ad as B,M as P,a7 as le,_ as N,a6 as ae,af as i}from"./index-DVZnwRLO.js";import{V as te}from"./VSelect-n_QZYXYz.js";import"./startOfDay-gdqdGqv8.js";import"./format-BIKQltQg.js";import"./VList-BqLmgNZm.js";function se(c){const s=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return s.searchParams.append("dateFrom",x(c.dateFrom)),s.searchParams.append("dateTo",x(c.dateTo)),s.searchParams.append("page",c.page.toString()),s.searchParams.append("limit",c.limit.toString()),s.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),s}const ne={style:{position:"relative",height:"500px",width:"100%"}},ue={class:"d-flex align-center ga-4"},oe={class:"text-center"},he=H({__name:"orders",setup(c){const s=G(),{dateFrom:v,dateTo:f}=O(),m=D("page","1",{transform:Number});_(v,()=>{m.value=1}),_(f,()=>{m.value=1});const U=W(new Date),R=new Date,E=b(()=>se({dateFrom:v.value??U,dateTo:f.value??R,page:m.value,limit:100}).href),{execute:$,isFetching:A,error:C,data:g}=j(E,{refetch:!0}).get().json(),{isLoading:L}=Z();_(A,t=>{L.value=t});const o=J([]),w=D("warehouses",null),r=b({get(){return w.value==null?o.value:w.value.split(",")},set(t){t.length==o.value.length?w.value=null:w.value=t.join(",")}});_(g,t=>{if(t!=null){const e=o.value.length==r.value.length;o.value=[...new Set([...t.data.map(d=>d.warehouse_name),...o.value])],(r.value.length==0||e)&&(r.value=o.value)}}),K(()=>{s.dateFrom=v.value,s.dateTo=f.value,s.page=m.value,o.value.length!=r.value.length?s.warehouseNamesFilter=r.value:s.warehouseNamesFilter=null});const y=b(()=>g.value==null?[]:g.value.data.filter(t=>r.value.includes(t.warehouse_name))),Q=b(()=>{const t=[...new Set(y.value.map(d=>d.warehouse_name))],e=[];for(const d of t){const V=y.value.reduce((a,q)=>(q.warehouse_name==d?1:0)+a,0);e.push(V)}return{labels:t,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var V;const d=X("v-date-input");return h(),F(N,null,[e[9]||(e[9]=l("h1",{class:"mb-8"},"Заказы",-1)),l("div",ne,[n(u(M),{data:Q.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),n(Y,null,{default:p(()=>[n(S,{cols:"12",sm:"6"},{default:p(()=>[n(d,{label:"Начиная с даты",modelValue:u(v),"onUpdate:modelValue":e[0]||(e[0]=a=>k(v)?v.value=a:null)},null,8,["modelValue"])]),_:1}),n(S,{cols:"12",sm:"6"},{default:p(()=>[n(d,{label:"Заканчивая датой",modelValue:u(f),"onUpdate:modelValue":e[1]||(e[1]=a=>k(f)?f.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),l("div",ue,[n(P,{disabled:r.value.length==u(o).length,onClick:e[2]||(e[2]=a=>r.value=u(o))},{default:p(()=>e[5]||(e[5]=[B("Сбросить")])),_:1,__:[5]},8,["disabled"]),n(te,{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value=a),items:u(o),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),u(C)!=null?(h(),ee(le,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:p(()=>[e[7]||(e[7]=l("p",null,"Ошибка при загрузке данных",-1)),n(P,{onClick:u($)},{default:p(()=>e[6]||(e[6]=[B("Попробовать ещё раз")])),_:1,__:[6]},8,["onClick"])]),_:1,__:[7]})):T("",!0),u(C)==null?(h(),F(N,{key:1},[n(z,{"fixed-header":"",striped:"even",class:"mt-8"},{default:p(()=>[e[8]||(e[8]=l("thead",null,[l("tr",null,[l("th",null,"Артикул"),l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Полная сумма"),l("th",null,"Скидка"),l("th",null,"Отменён"),l("th",null,"Регион"),l("th",null,"Склад")])],-1)),l("tbody",null,[(h(!0),F(N,null,ae(y.value,a=>(h(),F("tr",null,[l("td",null,i(a.nm_id),1),l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.is_cancel?"Да":"Нет"),1),l("td",null,i(a.oblast),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1,__:[8]}),l("div",oe,[n(I,{modelValue:u(m),"onUpdate:modelValue":e[4]||(e[4]=a=>k(m)?m.value=a:null),length:(V=u(g))==null?void 0:V.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):T("",!0)],64)}}});export{he as default};
