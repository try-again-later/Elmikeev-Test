import{u as J,V as L,a as K,b as y,c as X}from"./VSelect-CoX54rQI.js";import{u as Q}from"./index-CVG1nkrh.js";import{o as Y}from"./list-CojviVac.js";import{u as Z,s as ee}from"./useDateRangeQuery-BZScIdAx.js";import{u as le}from"./useNProgress-BhzykK6_.js";import{B as ae}from"./index-Bs4QrVmf.js";import{u as te}from"./orderFilters-De97LsVu.js";import{a1 as ue,C as S,q as D,A as m,I as ne,a2 as oe,a3 as k,a4 as c,h as a,c as o,a8 as se,a9 as j,aq as u,a5 as b,ar as h,ap as E,M,a7 as re,_ as B,a6 as de,at as i}from"./index-CBPJuryY.js";import{V as ie}from"./VPagination-BkBWmOM3.js";import"./VList-DPzMOoVM.js";import"./format-_sNi8qoz.js";import"./startOfDay-CTcnnNpE.js";const me={style:{position:"relative",height:"500px",width:"100%"}},ve={class:"d-flex align-center ga-4"},pe={class:"text-center"},De=ue({__name:"orders",setup(fe){const s=te(),{dateFrom:w,dateTo:F}=Z(),v=Q("page","1",{transform:Number});S(w,()=>{v.value=1}),S(F,()=>{v.value=1});const P=ee(new Date),I=new Date,O=D(()=>Y({dateFrom:w.value??P,dateTo:F.value??I,page:v.value,limit:100}).href),{execute:R,isFetching:W,error:T,data:N}=J(O,{refetch:!0}).get().json(),{isLoading:z}=le();S(W,t=>{z.value=t});const r=m([]),x=Q("warehouses",null),d=D({get(){return x.value==null?r.value:x.value.split(",")},set(t){t.length==r.value.length?x.value=null:x.value=t.join(",")}}),A=m([]),p=m(s.partNamesFilter),_=m([]),f=m(s.brandFilter),$=m([]),g=m(s.categoryFilter),q=m([]),V=m(s.regionFilter);ne(()=>{s.dateFrom=w.value,s.dateTo=F.value,s.page=v.value,r.value.length!=d.value.length?s.warehouseNamesFilter=d.value:s.warehouseNamesFilter=null,s.partNamesFilter=p.value,s.brandFilter=f.value,s.categoryFilter=g.value,s.regionFilter=V.value}),S(N,t=>{if(t!=null){const e=r.value.length==d.value.length;r.value=[...new Set([...t.data.map(n=>n.warehouse_name),...r.value])],(d.value.length==0||e)&&(d.value=r.value),A.value=[...new Set([...t.data.map(n=>n.nm_id),...p.value])],_.value=[...new Set([...t.data.map(n=>n.brand),...f.value])],$.value=[...new Set([...t.data.map(n=>n.category),...g.value])],q.value=[...new Set([...t.data.map(n=>n.oblast),...V.value])]}});const U=D(()=>N.value==null?[]:N.value.data.filter(t=>d.value.includes(t.warehouse_name)&&(p.value.length==0||p.value.includes(t.nm_id))&&(f.value.length==0||f.value.includes(t.brand))&&(g.value.length==0||g.value.includes(t.category))&&(V.value.length==0||V.value.includes(t.oblast)))),G=D(()=>{const t=[...new Set(U.value.map(n=>n.warehouse_name))],e=[];for(const n of t){const C=U.value.reduce((l,H)=>(H.warehouse_name==n?1:0)+l,0);e.push(C)}return{labels:t,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var C;const n=oe("v-date-input");return c(),k(B,null,[e[18]||(e[18]=a("h1",{class:"mb-8"},"Заказы",-1)),a("div",me,[o(u(ae),{data:G.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),o(K,null,{default:b(()=>[o(L,{cols:"12",sm:"6"},{default:b(()=>[o(n,{label:"Начиная с даты",modelValue:u(w),"onUpdate:modelValue":e[0]||(e[0]=l=>h(w)?w.value=l:null)},null,8,["modelValue"])]),_:1}),o(L,{cols:"12",sm:"6"},{default:b(()=>[o(n,{label:"Заканчивая датой",modelValue:u(F),"onUpdate:modelValue":e[1]||(e[1]=l=>h(F)?F.value=l:null)},null,8,["modelValue"])]),_:1})]),_:1}),a("div",ve,[o(M,{disabled:d.value.length==u(r).length,onClick:e[2]||(e[2]=l=>d.value=u(r))},{default:b(()=>e[9]||(e[9]=[E("Сбросить")])),_:1,__:[9]},8,["disabled"]),o(y,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=l=>d.value=l),items:u(r),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),u(T)!=null?(c(),se(re,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:b(()=>[e[11]||(e[11]=a("p",null,"Ошибка при загрузке данных",-1)),o(M,{onClick:u(R)},{default:b(()=>e[10]||(e[10]=[E("Попробовать ещё раз")])),_:1,__:[10]},8,["onClick"])]),_:1,__:[11]})):j("",!0),u(T)==null?(c(),k(B,{key:1},[o(X,{"fixed-header":"",striped:"even",class:"mt-8"},{default:b(()=>[a("thead",null,[a("tr",null,[a("th",null,[o(y,{modelValue:u(p),"onUpdate:modelValue":e[4]||(e[4]=l=>h(p)?p.value=l:null),items:u(A),"min-width":"200","max-width":"400",label:"Артикул",multiple:""},null,8,["modelValue","items"])]),e[12]||(e[12]=a("th",null,"Штрих-код",-1)),e[13]||(e[13]=a("th",null,"Дата",-1)),a("th",null,[o(y,{modelValue:u(f),"onUpdate:modelValue":e[5]||(e[5]=l=>h(f)?f.value=l:null),items:u(_),"min-width":"200","max-width":"400",label:"Брэнд",multiple:""},null,8,["modelValue","items"])]),a("th",null,[o(y,{modelValue:u(g),"onUpdate:modelValue":e[6]||(e[6]=l=>h(g)?g.value=l:null),items:u($),"min-width":"200","max-width":"400",label:"Категория",multiple:""},null,8,["modelValue","items"])]),e[14]||(e[14]=a("th",null,"Полная сумма",-1)),e[15]||(e[15]=a("th",null,"Скидка",-1)),e[16]||(e[16]=a("th",null,"Отменён",-1)),a("th",null,[o(y,{modelValue:u(V),"onUpdate:modelValue":e[7]||(e[7]=l=>h(V)?V.value=l:null),items:u(q),"min-width":"200","max-width":"400",label:"Регион",multiple:""},null,8,["modelValue","items"])]),e[17]||(e[17]=a("th",null,"Склад",-1))])]),a("tbody",null,[(c(!0),k(B,null,de(U.value,l=>(c(),k("tr",null,[a("td",null,i(l.nm_id),1),a("td",null,i(l.barcode),1),a("td",null,i(l.date),1),a("td",null,i(l.brand),1),a("td",null,i(l.category),1),a("td",null,i(parseFloat(l.total_price).toFixed(2)),1),a("td",null,i(`${l.discount_percent}%`),1),a("td",null,i(l.is_cancel?"Да":"Нет"),1),a("td",null,i(l.oblast),1),a("td",null,i(l.warehouse_name),1)]))),256))])]),_:1}),a("div",pe,[o(ie,{modelValue:u(v),"onUpdate:modelValue":e[8]||(e[8]=l=>h(v)?v.value=l:null),length:(C=u(N))==null?void 0:C.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):j("",!0)],64)}}});export{De as default};
