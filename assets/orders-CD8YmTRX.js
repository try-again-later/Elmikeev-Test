import{u as G,B as H,V as $,a as J}from"./Request-BA6AlAT3.js";import{u as q,V as x,a as K,b as X}from"./VTable-jvydNw2X.js";import{o as Y}from"./list-BDvZCJTr.js";import{u as Z}from"./useDateRangeQuery-C0I6GGDn.js";import{s as ee,u as le}from"./useNProgress-B_hvUdFX.js";import{u as ae}from"./orderFilters-DqU7cTJ_.js";import{a1 as te,C,q as D,A as g,I as ue,a2 as ne,a3 as S,a4 as F,h as l,c as s,a8 as se,a9 as L,ar as u,a5 as V,aq as h,ap as Q,M as j,a7 as oe,_ as U,a6 as re,at as i}from"./index-Biun5NIw.js";import"./VList-Cwj9uxV4.js";import"./toDate-CP9kJ8oq.js";import"./format-CeBg1aLf.js";const de={style:{position:"relative",height:"500px",width:"100%"}},ie={class:"d-flex align-center ga-4"},me={class:"text-center"},ce=te({__name:"orders",setup(ve){const o=ae(),{dateFrom:b,dateTo:w}=Z(),m=q("page","1",{transform:Number});C(b,()=>{m.value=1}),C(w,()=>{m.value=1});const E=ee(new Date),M=new Date,P=D(()=>Y({dateFrom:b.value??E,dateTo:w.value??M,page:m.value,limit:100}).href),{execute:R,isFetching:I,error:B,data:y}=G(P,{refetch:!0}).get().json(),{isLoading:O}=le();C(I,t=>{O.value=t});const r=g([]),N=q("warehouses",null),d=D({get(){return N.value==null?r.value:N.value.split(",")},set(t){t.length==r.value.length?N.value=null:N.value=t.join(",")}}),T=g([]),v=g(o.partNamesFilter),A=g([]),p=g(o.brandFilter),_=g([]),f=g(o.categoryFilter);ue(()=>{o.dateFrom=b.value,o.dateTo=w.value,o.page=m.value,r.value.length!=d.value.length?o.warehouseNamesFilter=d.value:o.warehouseNamesFilter=null,o.partNamesFilter=v.value,o.brandFilter=p.value,o.categoryFilter=f.value}),C(y,t=>{if(t!=null){const e=r.value.length==d.value.length;r.value=[...new Set([...t.data.map(n=>n.warehouse_name),...r.value])],(d.value.length==0||e)&&(d.value=r.value),T.value=[...new Set([...t.data.map(n=>n.nm_id),...v.value])],A.value=[...new Set([...t.data.map(n=>n.brand),...p.value])],_.value=[...new Set([...t.data.map(n=>n.category),...f.value])]}});const k=D(()=>y.value==null?[]:y.value.data.filter(t=>d.value.includes(t.warehouse_name)&&(v.value.length==0||v.value.includes(t.nm_id))&&(p.value.length==0||p.value.includes(t.brand))&&(f.value.length==0||f.value.includes(t.category)))),W=D(()=>{const t=[...new Set(k.value.map(n=>n.warehouse_name))],e=[];for(const n of t){const c=k.value.reduce((a,z)=>(z.warehouse_name==n?1:0)+a,0);e.push(c)}return{labels:t,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(t,e)=>{var c;const n=ne("v-date-input");return F(),S(U,null,[e[18]||(e[18]=l("h1",{class:"mb-8"},"Заказы",-1)),l("div",de,[s(u(H),{data:W.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),s(J,null,{default:V(()=>[s($,{cols:"12",sm:"6"},{default:V(()=>[s(n,{label:"Начиная с даты",modelValue:u(b),"onUpdate:modelValue":e[0]||(e[0]=a=>h(b)?b.value=a:null)},null,8,["modelValue"])]),_:1}),s($,{cols:"12",sm:"6"},{default:V(()=>[s(n,{label:"Заканчивая датой",modelValue:u(w),"onUpdate:modelValue":e[1]||(e[1]=a=>h(w)?w.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),l("div",ie,[s(j,{disabled:d.value.length==u(r).length,onClick:e[2]||(e[2]=a=>d.value=u(r))},{default:V(()=>e[8]||(e[8]=[Q("Сбросить")])),_:1,__:[8]},8,["disabled"]),s(x,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),items:u(r),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),u(B)!=null?(F(),se(oe,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:V(()=>[e[10]||(e[10]=l("p",null,"Ошибка при загрузке данных",-1)),s(j,{onClick:u(R)},{default:V(()=>e[9]||(e[9]=[Q("Попробовать ещё раз")])),_:1,__:[9]},8,["onClick"])]),_:1,__:[10]})):L("",!0),u(B)==null?(F(),S(U,{key:1},[s(K,{"fixed-header":"",striped:"even",class:"mt-8"},{default:V(()=>[l("thead",null,[l("tr",null,[l("th",null,[s(x,{modelValue:u(v),"onUpdate:modelValue":e[4]||(e[4]=a=>h(v)?v.value=a:null),items:u(T),"min-width":"200","max-width":"400",label:"Артикул",multiple:""},null,8,["modelValue","items"])]),e[11]||(e[11]=l("th",null,"Штрих-код",-1)),e[12]||(e[12]=l("th",null,"Дата",-1)),l("th",null,[s(x,{modelValue:u(p),"onUpdate:modelValue":e[5]||(e[5]=a=>h(p)?p.value=a:null),items:u(A),"min-width":"200","max-width":"400",label:"Брэнд",multiple:""},null,8,["modelValue","items"])]),l("th",null,[s(x,{modelValue:u(f),"onUpdate:modelValue":e[6]||(e[6]=a=>h(f)?f.value=a:null),items:u(_),"min-width":"200","max-width":"400",label:"Категория",multiple:""},null,8,["modelValue","items"])]),e[13]||(e[13]=l("th",null,"Полная сумма",-1)),e[14]||(e[14]=l("th",null,"Скидка",-1)),e[15]||(e[15]=l("th",null,"Отменён",-1)),e[16]||(e[16]=l("th",null,"Регион",-1)),e[17]||(e[17]=l("th",null,"Склад",-1))])]),l("tbody",null,[(F(!0),S(U,null,re(k.value,a=>(F(),S("tr",null,[l("td",null,i(a.nm_id),1),l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(a.brand),1),l("td",null,i(a.category),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.is_cancel?"Да":"Нет"),1),l("td",null,i(a.oblast),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1}),l("div",me,[s(X,{modelValue:u(m),"onUpdate:modelValue":e[7]||(e[7]=a=>h(m)?m.value=a:null),length:(c=u(y))==null?void 0:c.meta.last_page,density:t.$vuetify.display.smAndDown?"compact":"default","total-visible":t.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):L("",!0)],64)}}});export{ce as default};
