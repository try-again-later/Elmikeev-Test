import{d as F,u as $,a as E,V as k,b as L,c as q,e as A}from"./VTable-CVhwq2t8.js";import{u as Q,a as Y}from"./useNProgress-DJwbbBWi.js";import{a1 as j,C as V,q as x,A as C,a2 as z,a3 as h,a4 as f,h as l,c as s,a8 as M,a9 as N,a5 as d,aa as _,ab as n,ac as D,M as P,a7 as W,_ as b,a6 as Z,ae as i}from"./index-DVp1P4s5.js";import{V as G}from"./VSelect-DJ4UyHTi.js";import"./VList-CxFkIYL5.js";function H(p){const t=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return t.searchParams.append("dateFrom",F(p.dateFrom)),t.searchParams.append("dateTo",F(p.dateTo)),t.searchParams.append("page",p.page.toString()),t.searchParams.append("limit",p.limit.toString()),t.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),t}const I={class:"d-flex align-center ga-4"},J={class:"text-center"},ae=j({__name:"orders",setup(p){const{dateFrom:t,dateTo:v}=Q(),m=$("page","1",{transform:Number});V(t,()=>{m.value=1}),V(v,()=>{m.value=1});const T=x(()=>H({dateFrom:t.value??new Date,dateTo:v.value??new Date,page:m.value,limit:100}).href),{execute:U,isFetching:B,error:w,data:g}=E(T,{refetch:!0}).get().json(),{isLoading:S}=Y();V(B,o=>{S.value=o});const r=C([]),u=C([]);V(g,o=>{if(o!=null){const e=r.value.length==u.value.length;r.value=[...new Set([...o.data.map(c=>c.warehouse_name),...r.value])],(u.value.length==0||e)&&(u.value=r.value)}});const R=x(()=>g.value==null?[]:g.value.data.filter(o=>u.value.includes(o.warehouse_name)));return(o,e)=>{var y;const c=z("v-date-input");return f(),h(b,null,[e[9]||(e[9]=l("h1",{class:"mb-8"},"Заказы",-1)),s(L,null,{default:d(()=>[s(k,{cols:"12",sm:"6"},{default:d(()=>[s(c,{label:"Начиная с даты",modelValue:n(t),"onUpdate:modelValue":e[0]||(e[0]=a=>_(t)?t.value=a:null)},null,8,["modelValue"])]),_:1}),s(k,{cols:"12",sm:"6"},{default:d(()=>[s(c,{label:"Заканчивая датой",modelValue:n(v),"onUpdate:modelValue":e[1]||(e[1]=a=>_(v)?v.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),l("div",I,[s(P,{disabled:n(u).length==n(r).length,onClick:e[2]||(e[2]=a=>u.value=n(r))},{default:d(()=>e[5]||(e[5]=[D("Сбросить")])),_:1,__:[5]},8,["disabled"]),s(G,{modelValue:n(u),"onUpdate:modelValue":e[3]||(e[3]=a=>_(u)?u.value=a:null),items:n(r),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),n(w)!=null?(f(),M(W,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:d(()=>[e[7]||(e[7]=l("p",null,"Ошибка при загрузке данных",-1)),s(P,{onClick:n(U)},{default:d(()=>e[6]||(e[6]=[D("Попробовать ещё раз")])),_:1,__:[6]},8,["onClick"])]),_:1,__:[7]})):N("",!0),n(w)==null?(f(),h(b,{key:1},[s(q,{"fixed-header":"",striped:"even",class:"mt-8"},{default:d(()=>[e[8]||(e[8]=l("thead",null,[l("tr",null,[l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Полная сумма"),l("th",null,"Скидка"),l("th",null,"Отменён"),l("th",null,"Регион"),l("th",null,"Склад")])],-1)),l("tbody",null,[(f(!0),h(b,null,Z(R.value,a=>(f(),h("tr",null,[l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.is_cancel?"Да":"Нет"),1),l("td",null,i(a.oblast),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1,__:[8]}),l("div",J,[s(A,{modelValue:n(m),"onUpdate:modelValue":e[4]||(e[4]=a=>_(m)?m.value=a:null),length:(y=n(g))==null?void 0:y.meta.last_page,density:o.$vuetify.display.smAndDown?"compact":"default","total-visible":o.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):N("",!0)],64)}}});export{ae as default};
