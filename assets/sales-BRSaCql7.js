import{d as D,u as q,a as Q,B as Y,V as b,b as U,c as j,e as z}from"./VTable-C-ahyCjR.js";import{u as I,a as W}from"./useNProgress-DiJogj6v.js";import{a1 as Z,C as _,q as k,A as w,a2 as G,a3 as y,a4 as g,h as l,c as t,a8 as H,a9 as B,a5 as r,aa as n,a7 as R,ab as h,ac as T,ad as M,M as J,_ as N,a6 as K,ae as i}from"./index-De13Hf0X.js";import{V as O}from"./VRangeSlider-eeVPLJo8.js";function X(v){const u=new URL("https://elmikeev.185-236-23-37.sslip.io/api/sales");return u.searchParams.append("dateFrom",D(v.dateFrom)),u.searchParams.append("dateTo",D(v.dateTo)),u.searchParams.append("page",v.page.toString()),u.searchParams.append("limit",v.limit.toString()),u.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),u}const ee={class:"text-center"},se=Z({__name:"sales",setup(v){const{dateFrom:u,dateTo:f}=I(),m=q("page","1",{transform:Number});_(u,()=>{m.value=1}),_(f,()=>{m.value=1});const S=k(()=>X({dateFrom:u.value??new Date,dateTo:f.value??new Date,page:m.value,limit:100}).href),{execute:A,isFetching:E,error:P,data:V}=Q(S,{refetch:!0}).get().json(),{isLoading:L}=W();_(E,s=>{L.value=s});const x=w(0),p=w(0),o=w([x.value,p.value]);_(V,s=>{if(s!=null){const e=o.value[1]==p.value;x.value=0,p.value=Math.max(Math.ceil(s.data.reduce((d,c)=>Math.max(d,Number.parseFloat(c.total_price)||0),0)),p.value),(o.value[1]==0||e)&&(o.value[1]=p.value)}});const F=k(()=>V.value==null?[]:V.value.data.filter(s=>o.value[0]<=Number.parseFloat(s.total_price)&&Number.parseFloat(s.total_price)<=o.value[1])),$=k(()=>{const s=[...new Set(F.value.map(d=>d.region_name))],e=[];for(const d of s){const c=F.value.reduce((a,C)=>(C.region_name==d?Number.parseFloat(C.total_price):0)+a,0);e.push(c)}return{labels:s,datasets:[{data:e,label:"Полная сумма по региону",backgroundColor:"rgb(255, 99, 132)"}]}});return(s,e)=>{var c;const d=G("v-date-input");return g(),y(N,null,[e[10]||(e[10]=l("h1",{class:"mb-8"},"Продажи",-1)),t(R,{class:"position-relative",height:"500"},{default:r(()=>[t(n(Y),{data:$.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),t(U,null,{default:r(()=>[t(b,{cols:"12",sm:"6"},{default:r(()=>[t(d,{label:"Начиная с даты",modelValue:n(u),"onUpdate:modelValue":e[0]||(e[0]=a=>h(u)?u.value=a:null)},null,8,["modelValue"])]),_:1}),t(b,{cols:"12",sm:"6"},{default:r(()=>[t(d,{label:"Заканчивая датой",modelValue:n(f),"onUpdate:modelValue":e[1]||(e[1]=a=>h(f)?f.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),t(U,null,{default:r(()=>[t(b,{cols:"12",md:"1",class:"d-flex align-center"},{default:r(()=>e[6]||(e[6]=[T("Полная сумма:")])),_:1,__:[6]}),t(b,null,{default:r(()=>[t(O,{modelValue:n(o),"onUpdate:modelValue":e[4]||(e[4]=a=>h(o)?o.value=a:null),max:n(p),min:n(x),step:1,class:"align-center","hide-details":""},{prepend:r(()=>[t(M,{modelValue:n(o)[0],"onUpdate:modelValue":e[2]||(e[2]=a=>n(o)[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:r(()=>[t(M,{modelValue:n(o)[1],"onUpdate:modelValue":e[3]||(e[3]=a=>n(o)[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),n(P)!=null?(g(),H(R,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:r(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),t(J,{onClick:n(A)},{default:r(()=>e[7]||(e[7]=[T("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):B("",!0),n(P)==null?(g(),y(N,{key:1},[t(j,{"fixed-header":"",striped:"even",class:"mt-8"},{default:r(()=>[e[9]||(e[9]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Полная сумма"),l("th",null,"Скидка"),l("th",null,"Регион"),l("th",null,"Склад")])],-1)),l("tbody",null,[(g(!0),y(N,null,K(F.value,a=>(g(),y("tr",null,[l("td",null,i(a.sale_id),1),l("td",null,i(a.barcode),1),l("td",null,i(a.date),1),l("td",null,i(parseFloat(a.total_price).toFixed(2)),1),l("td",null,i(`${a.discount_percent}%`),1),l("td",null,i(a.region_name),1),l("td",null,i(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),l("div",ee,[t(z,{modelValue:n(m),"onUpdate:modelValue":e[5]||(e[5]=a=>h(m)?m.value=a:null),length:(c=n(V))==null?void 0:c.meta.last_page,density:s.$vuetify.display.smAndDown?"compact":"default","total-visible":s.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):B("",!0)],64)}}});export{se as default};
