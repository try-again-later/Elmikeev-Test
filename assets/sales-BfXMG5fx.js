import{d as N,u as L,a as $,V as y,b as P,c as q,e as A}from"./VTable-CVhwq2t8.js";import{u as Q,a as Y}from"./useNProgress-DJwbbBWi.js";import{V as j}from"./VRangeSlider-sdkikzwl.js";import{a1 as z,C as _,q as U,A as h,a2 as I,a3 as b,a4 as f,h as l,c as t,a8 as Z,a9 as C,a5 as o,aa as x,ab as n,ac as D,ad as T,M as G,a7 as H,_ as F,a6 as J,ae as r}from"./index-DVp1P4s5.js";function K(m){const u=new URL("https://elmikeev.185-236-23-37.sslip.io/api/sales");return u.searchParams.append("dateFrom",N(m.dateFrom)),u.searchParams.append("dateTo",N(m.dateTo)),u.searchParams.append("page",m.page.toString()),u.searchParams.append("limit",m.limit.toString()),u.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),u}const O={class:"text-center"},ae=z({__name:"sales",setup(m){const{dateFrom:u,dateTo:p}=Q(),i=L("page","1",{transform:Number});_(u,()=>{i.value=1}),_(p,()=>{i.value=1});const R=U(()=>K({dateFrom:u.value??new Date,dateTo:p.value??new Date,page:i.value,limit:100}).href),{execute:B,isFetching:M,error:k,data:V}=$(R,{refetch:!0}).get().json(),{isLoading:S}=Y();_(M,d=>{S.value=d});const c=h(0),v=h(0),s=h([c.value,v.value]);_(V,d=>{d!=null&&(c.value=0,v.value=Math.max(Math.ceil(d.data.reduce((e,g)=>Math.max(e,Number.parseFloat(g.total_price)||0),0)),v.value),s.value[1]==0&&(s.value=[c.value,v.value]))});const E=U(()=>V.value==null?[]:V.value.data.filter(d=>s.value[0]<=Number.parseFloat(d.total_price)&&Number.parseFloat(d.total_price)<=s.value[1]));return(d,e)=>{var w;const g=I("v-date-input");return f(),b(F,null,[e[10]||(e[10]=l("h1",{class:"mb-8"},"Продажи",-1)),t(P,null,{default:o(()=>[t(y,{cols:"12",sm:"6"},{default:o(()=>[t(g,{label:"Начиная с даты",modelValue:n(u),"onUpdate:modelValue":e[0]||(e[0]=a=>x(u)?u.value=a:null)},null,8,["modelValue"])]),_:1}),t(y,{cols:"12",sm:"6"},{default:o(()=>[t(g,{label:"Заканчивая датой",modelValue:n(p),"onUpdate:modelValue":e[1]||(e[1]=a=>x(p)?p.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),t(P,null,{default:o(()=>[t(y,{cols:"12",md:"1",class:"d-flex align-center"},{default:o(()=>e[6]||(e[6]=[D("Полная сумма:")])),_:1,__:[6]}),t(y,null,{default:o(()=>[t(j,{modelValue:n(s),"onUpdate:modelValue":e[4]||(e[4]=a=>x(s)?s.value=a:null),max:n(v),min:n(c),step:1,class:"align-center","hide-details":""},{prepend:o(()=>[t(T,{modelValue:n(s)[0],"onUpdate:modelValue":e[2]||(e[2]=a=>n(s)[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:o(()=>[t(T,{modelValue:n(s)[1],"onUpdate:modelValue":e[3]||(e[3]=a=>n(s)[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),n(k)!=null?(f(),Z(H,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:o(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),t(G,{onClick:n(B)},{default:o(()=>e[7]||(e[7]=[D("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):C("",!0),n(k)==null?(f(),b(F,{key:1},[t(q,{"fixed-header":"",striped:"even",class:"mt-8"},{default:o(()=>[e[9]||(e[9]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Полная сумма"),l("th",null,"Скидка"),l("th",null,"Регион"),l("th",null,"Склад")])],-1)),l("tbody",null,[(f(!0),b(F,null,J(E.value,a=>(f(),b("tr",null,[l("td",null,r(a.sale_id),1),l("td",null,r(a.barcode),1),l("td",null,r(a.date),1),l("td",null,r(parseFloat(a.total_price).toFixed(2)),1),l("td",null,r(`${a.discount_percent}%`),1),l("td",null,r(a.region_name),1),l("td",null,r(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),l("div",O,[t(A,{modelValue:n(i),"onUpdate:modelValue":e[5]||(e[5]=a=>x(i)?i.value=a:null),length:(w=n(V))==null?void 0:w.meta.last_page,density:d.$vuetify.display.smAndDown?"compact":"default","total-visible":d.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):C("",!0)],64)}}});export{ae as default};
