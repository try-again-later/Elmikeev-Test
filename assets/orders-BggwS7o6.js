import{d as x,u as Q,a as M,B as Y,V as D,b as j,c as z,e as O}from"./VTable-BF8sXkJI.js";import{u as W,s as Z,a as G}from"./useNProgress-BV2_3ggy.js";import{u as H}from"./orderFilters-dWmtIC1M.js";import{a1 as I,C as c,q as y,A as N,a2 as J,a3 as b,a4 as g,h as a,c as n,a8 as K,a9 as S,ab as t,a5 as v,ac as w,ad as T,M as B,a7 as X,_ as k,a6 as ee,af as d}from"./index-OFEXPl3t.js";import{V as ae}from"./VSelect-BqQKt7q8.js";import"./startOfDay-gdqdGqv8.js";import"./format-BIKQltQg.js";import"./VList-C5vUUlEX.js";function le(h){const o=new URL("https://elmikeev.185-236-23-37.sslip.io/api/orders");return o.searchParams.append("dateFrom",x(h.dateFrom)),o.searchParams.append("dateTo",x(h.dateTo)),o.searchParams.append("page",h.page.toString()),o.searchParams.append("limit",h.limit.toString()),o.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),o}const te={style:{position:"relative",height:"500px",width:"100%"}},se={class:"d-flex align-center ga-4"},ne={class:"text-center"},fe=I({__name:"orders",setup(h){const o=H(),{dateFrom:i,dateTo:m}=W();c(i,()=>{o.dateFrom=i.value}),c(m,()=>{o.dateTo=m.value});const f=Q("page","1",{transform:Number});c(i,()=>{f.value=1}),c(m,()=>{f.value=1});const P=Z(new Date),U=new Date,R=y(()=>le({dateFrom:i.value??P,dateTo:m.value??U,page:f.value,limit:100}).href),{execute:$,isFetching:A,error:C,data:V}=M(R,{refetch:!0}).get().json(),{isLoading:E}=G();c(A,s=>{E.value=s});const p=N([]),u=N([]);c(V,s=>{if(s!=null){const e=p.value.length==u.value.length;p.value=[...new Set([...s.data.map(r=>r.warehouse_name),...p.value])],(u.value.length==0||e)&&(u.value=p.value)}});const F=y(()=>V.value==null?[]:V.value.data.filter(s=>u.value.includes(s.warehouse_name))),L=y(()=>{const s=[...new Set(F.value.map(r=>r.warehouse_name))],e=[];for(const r of s){const _=F.value.reduce((l,q)=>(q.warehouse_name==r?1:0)+l,0);e.push(_)}return{labels:s,datasets:[{data:e,label:"Количество заказов по каждому складу",backgroundColor:"rgb(255, 99, 132)"}]}});return(s,e)=>{var _;const r=J("v-date-input");return g(),b(k,null,[e[9]||(e[9]=a("h1",{class:"mb-8"},"Заказы",-1)),a("div",te,[n(t(Y),{data:L.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),n(j,null,{default:v(()=>[n(D,{cols:"12",sm:"6"},{default:v(()=>[n(r,{label:"Начиная с даты",modelValue:t(i),"onUpdate:modelValue":e[0]||(e[0]=l=>w(i)?i.value=l:null)},null,8,["modelValue"])]),_:1}),n(D,{cols:"12",sm:"6"},{default:v(()=>[n(r,{label:"Заканчивая датой",modelValue:t(m),"onUpdate:modelValue":e[1]||(e[1]=l=>w(m)?m.value=l:null)},null,8,["modelValue"])]),_:1})]),_:1}),a("div",se,[n(B,{disabled:t(u).length==t(p).length,onClick:e[2]||(e[2]=l=>u.value=t(p))},{default:v(()=>e[5]||(e[5]=[T("Сбросить")])),_:1,__:[5]},8,["disabled"]),n(ae,{modelValue:t(u),"onUpdate:modelValue":e[3]||(e[3]=l=>w(u)?u.value=l:null),items:t(p),label:"Названия складов",multiple:"","persistent-hint":""},null,8,["modelValue","items"])]),t(C)!=null?(g(),K(X,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:v(()=>[e[7]||(e[7]=a("p",null,"Ошибка при загрузке данных",-1)),n(B,{onClick:t($)},{default:v(()=>e[6]||(e[6]=[T("Попробовать ещё раз")])),_:1,__:[6]},8,["onClick"])]),_:1,__:[7]})):S("",!0),t(C)==null?(g(),b(k,{key:1},[n(z,{"fixed-header":"",striped:"even",class:"mt-8"},{default:v(()=>[e[8]||(e[8]=a("thead",null,[a("tr",null,[a("th",null,"Артикул"),a("th",null,"Штрих-код"),a("th",null,"Дата"),a("th",null,"Полная сумма"),a("th",null,"Скидка"),a("th",null,"Отменён"),a("th",null,"Регион"),a("th",null,"Склад")])],-1)),a("tbody",null,[(g(!0),b(k,null,ee(F.value,l=>(g(),b("tr",null,[a("td",null,d(l.nm_id),1),a("td",null,d(l.barcode),1),a("td",null,d(l.date),1),a("td",null,d(parseFloat(l.total_price).toFixed(2)),1),a("td",null,d(`${l.discount_percent}%`),1),a("td",null,d(l.is_cancel?"Да":"Нет"),1),a("td",null,d(l.oblast),1),a("td",null,d(l.warehouse_name),1)]))),256))])]),_:1,__:[8]}),a("div",ne,[n(O,{modelValue:t(f),"onUpdate:modelValue":e[4]||(e[4]=l=>w(f)?f.value=l:null),length:(_=t(V))==null?void 0:_.meta.last_page,density:s.$vuetify.display.smAndDown?"compact":"default","total-visible":s.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):S("",!0)],64)}}});export{fe as default};
