import{d as C,u as Q,a as $,B as Y,V as g,b as D,c as j,e as z}from"./VTable-C9JgfbDn.js";import{u as W,a as Z}from"./useNProgress-Chqm1PVE.js";import{a1 as G,C as h,q,A as k,a2 as H,a3 as x,a4 as c,h as l,c as t,a8 as I,a9 as R,a5 as d,aa as n,a7 as T,ab as b,ac as M,ad as N,M as J,_ as F,a6 as K,ae as V}from"./index-C9XFLqwp.js";import{V as O}from"./VRangeSlider-CkRgOA06.js";function X(v){const s=new URL("https://elmikeev.185-236-23-37.sslip.io/api/incomes");return s.searchParams.append("dateFrom",C(v.dateFrom)),s.searchParams.append("dateTo",C(v.dateTo)),s.searchParams.append("page",v.page.toString()),s.searchParams.append("limit",v.limit.toString()),s.searchParams.append("key","E6kUTYrYwZq2tN4QEtyzsbEBk3ie"),s}const ee={class:"text-center"},ue=G({__name:"incomes",setup(v){const{dateFrom:s,dateTo:f}=W(),i=Q("page","1",{transform:Number});h(s,()=>{i.value=1}),h(f,()=>{i.value=1});const P=q(()=>X({dateFrom:s.value??new Date,dateTo:f.value??new Date,page:i.value,limit:100}).href),{execute:S,isFetching:A,error:U,data:y}=$(P,{refetch:!0}).get().json(),{isLoading:E}=Z();h(A,u=>{E.value=u});const w=k(0),m=k(0),o=k([w.value,m.value]);h(y,u=>{if(u!=null){const e=o.value[1]==m.value;w.value=0,m.value=Math.max(Math.ceil(u.data.reduce((r,p)=>Math.max(r,p.quantity),0)),m.value),(o.value[1]==0||e)&&(o.value[1]=m.value)}});const _=q(()=>y.value==null?[]:y.value.data.filter(u=>o.value[0]<=u.quantity&&u.quantity<=o.value[1])),L=q(()=>{const u=[...new Set(_.value.map(r=>r.warehouse_name))],e=[];for(const r of u){const p=_.value.reduce((a,B)=>(B.warehouse_name==r?B.quantity:0)+a,0);e.push(p)}return{labels:u,datasets:[{data:e,label:"Суммарное количество в каждом складе"}]}});return(u,e)=>{var p;const r=H("v-date-input");return c(),x(F,null,[e[10]||(e[10]=l("h1",{class:"mb-8"},"Доходы",-1)),t(T,{class:"position-relative",height:"500"},{default:d(()=>[t(n(Y),{data:L.value,options:{responsive:!0,maintainAspectRatio:!1}},null,8,["data"])]),_:1}),t(D,null,{default:d(()=>[t(g,{cols:"12",sm:"6"},{default:d(()=>[t(r,{label:"Начиная с даты",modelValue:n(s),"onUpdate:modelValue":e[0]||(e[0]=a=>b(s)?s.value=a:null)},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",sm:"6"},{default:d(()=>[t(r,{label:"Заканчивая датой",modelValue:n(f),"onUpdate:modelValue":e[1]||(e[1]=a=>b(f)?f.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),t(D,null,{default:d(()=>[t(g,{cols:"12",md:"1",class:"d-flex align-center"},{default:d(()=>e[6]||(e[6]=[M("Фильтр по количеству:")])),_:1,__:[6]}),t(g,null,{default:d(()=>[t(O,{modelValue:n(o),"onUpdate:modelValue":e[4]||(e[4]=a=>b(o)?o.value=a:null),max:n(m),min:n(w),step:1,class:"align-center","hide-details":""},{prepend:d(()=>[t(N,{modelValue:n(o)[0],"onUpdate:modelValue":e[2]||(e[2]=a=>n(o)[0]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),append:d(()=>[t(N,{modelValue:n(o)[1],"onUpdate:modelValue":e[3]||(e[3]=a=>n(o)[1]=a),density:"compact",style:{width:"100px"},type:"number",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1},8,["modelValue","max","min"])]),_:1})]),_:1}),n(U)!=null?(c(),I(T,{key:0,class:"d-flex flex-column ga-4 align-center"},{default:d(()=>[e[8]||(e[8]=l("p",null,"Ошибка при загрузке данных",-1)),t(J,{onClick:n(S)},{default:d(()=>e[7]||(e[7]=[M("Попробовать ещё раз")])),_:1,__:[7]},8,["onClick"])]),_:1,__:[8]})):R("",!0),n(U)==null?(c(),x(F,{key:1},[t(j,{"fixed-header":"",striped:"even",class:"mt-8"},{default:d(()=>[e[9]||(e[9]=l("thead",null,[l("tr",null,[l("th",null,"Штрих-код"),l("th",null,"Дата"),l("th",null,"Дата закрытия"),l("th",null,"Количество"),l("th",null,"Склад")])],-1)),l("tbody",null,[(c(!0),x(F,null,K(_.value,a=>(c(),x("tr",null,[l("td",null,V(a.barcode),1),l("td",null,V(a.date),1),l("td",null,V(a.date_close),1),l("td",null,V(a.quantity),1),l("td",null,V(a.warehouse_name),1)]))),256))])]),_:1,__:[9]}),l("div",ee,[t(z,{modelValue:n(i),"onUpdate:modelValue":e[5]||(e[5]=a=>b(i)?i.value=a:null),length:(p=n(y))==null?void 0:p.meta.last_page,density:u.$vuetify.display.smAndDown?"compact":"default","total-visible":u.$vuetify.display.smAndDown?2:5},null,8,["modelValue","length","density","total-visible"])])],64)):R("",!0)],64)}}});export{ue as default};
